<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Hybrid Public Key Encryption</title>
<meta content="Richard L. Barnes" name="author">
<meta content="Karthik Bhargavan" name="author">
<meta content="Benjamin Lipp" name="author">
<meta content="Christopher A. Wood" name="author">
<meta content="
       This document describes a scheme for hybrid public key encryption (HPKE).
This scheme provides a variant of public key encryption of arbitrary-sized
plaintexts for a recipient public key. It also includes three authenticated
variants, including one that authenticates possession of a pre-shared key
and two optional ones that authenticate possession of a key encapsulation
mechanism (KEM) private key. HPKE works for any combination of an asymmetric
KEM, key derivation function (KDF), and authenticated encryption with
additional data (AEAD) encryption function. Some authenticated variants may not
be supported by all KEMs. We provide instantiations of the scheme using widely
used and efficient primitives, such as Elliptic Curve Diffie-Hellman (ECDH) key
agreement, HMAC-based key derivation function (HKDF), and SHA2. 
       This document is a product of the Crypto Forum Research Group (CFRG) in the IRTF. 
    " name="description">
<meta content="xml2rfc 3.28.1" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-barnes-hpke-hpke-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.28.1
    Python 3.12.9
    ConfigArgParse 1.7
    google-i18n-address 3.1.1
    intervaltree 3.1.0
    Jinja2 3.1.6
    lxml 5.3.0
    platformdirs 4.3.7
    pycountry 24.6.1
    PyYAML 6.0.2
    requests 2.32.3
    setuptools 70.3.0
    wcwidth 0.2.13
-->
<link href="draft-barnes-hpke-hpke.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  --font-title: "Sofia Sans Semi Condensed", sans-serif;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
section {
  clear: both;
}
.section-number {
  padding-right: 0.5em;
}
h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-title);
  font-weight: 680;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
  vertical-align: top;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
  & :is(ol, ul) {
    margin-left: 1em;
  }
}
li {
  margin: 0 0 0.25em 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
  & li {
    margin-top: 0.5em;
  }
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  margin: 0 0 0 2em;
  & li {
    margin: 0;
    & :first-child { margin-top: 0; }
    & :last-child { margin-bottom: 0; }
  }
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
  &.olPercent {
    --indent: 5ch;
    & > dt {
      min-width: calc(var(--indent) - 2ch);
    }
  }
  &.olPercent > dt {
    float: none;
  }

  dl > dd > & {
    margin-top: 0.5em;
    margin-bottom: 0;
  }
}
dl:not(.dlNewline) > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
  & > :is(:first-child, .break:first-child + *) {
    margin-top: 0;
  }
  & > :is(:last-child) {
    margin-bottom: 0;
  }
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
  caption-side: bottom;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    /* In the horizontal direction, sometimes people make over-sized figures.
       Scrollbars for those is therefore necessary: auto adds them as necessary..
       In the vertical direction, the line-height can combine with the font
       asender/descender height to produce scrollbars: hidden avoids that. */
    overflow: auto hidden;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: auto;
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
  &[href] {
    color: var(--pilcrow-weak);
    &:hover { text-decoration: none; }
  }
}
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
  & dt {
    width: var(--identifier-width);
    min-width: var(--identifier-width);
    clear: left;
    float: left;
    text-align: right;
    margin-right: 1ch;
  }
  & dd {
    margin: 0;
    margin-left: calc(1em + var(--identifier-width)) !important;
    min-width: 5em;
  }
  & .authors {
    & .author {
      display: inline-block;
      margin-right: 1.5em;
    }
    & .org {
      font-style: italic;
    }
  }
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;

  & nav {
    & ul {
      margin: 0 0.5em 0 0;
      padding: 0;
      list-style: none;
    }
    & li {
      line-height: 1.3em;
      margin: 2px 0;
      padding-left: 1.2em;
      text-indent: -1.2em;
    }
  }
  & a.xref {
    white-space: normal;
  }
}

.references {
  & > dt {
    text-align: right;
    font-weight: bold;
    min-width: 10ch;
    margin-right: 1.5ch;
    &:target::before {
      content: "⇒";
      margin: 0 10px 0 -25px;
    }
  }
  & > dd {
    margin-left: 12ch !important;
    overflow: visible;
    & .refInstance {
      margin-bottom: 0.8em;
    }
    & .ascii {
      margin-bottom: 0.25em;
    }
  }
}

#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  max-width: 20em;
  margin: 1em auto 1em 0;

  & .nameRole {
    font-weight: 700;
    margin-left: 0;
  }
  & .label {
    margin: 0.5em 0;
  }
  & .type {
    display: none;
  }
  & .alternative-contact {
    margin: 0.5em 0 0.25em 0;
  }
  & .non-ascii {
    margin: 0 0 0 2em;
  }
  & div.left {
    text-align: left;
  }
  & div.right {
    text-align: right;
  }
}

hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

/* Comments */
.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}

@media screen {
  #toc nav {
    font-family: var(--font-title);
    font-weight: 360;
    & > ul { margin-bottom: 2em; }
    & ul {
      margin: 0 0 0 4px;
      & :is(p, li) {
        margin: 2px 0;
      }
    }
  }
  #toc a.toplink {
    float: right;
  }
}
@media not screen {
  #toc a.toplink {
    display: none;
  }
}


/* TOC layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
    &::before { /* css hamburger */
      float: right;
      position: relative;
      width: 1em;
      height: 1px;
      left: -164px;
      margin: 8px 0 0 0;
      background: white none repeat scroll 0 0;
      box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
      content: "";
    }
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active {
    opacity: 1;
    & nav { display: block; }
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:is(:link, :focus, :hover),
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin: 2px 0.5em 0;
  }
}

/* TOC layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
  #toc a.toplink {
    margin: 8px 0.5em 0;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">HPKE</td>
<td class="right">April 2025</td>
</tr></thead>
<tfoot><tr>
<td class="left">Barnes, et al.</td>
<td class="center">Expires 5 October 2025</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">HPKE</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-barnes-hpke-hpke-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2025-04-03" class="published">3 April 2025</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2025-10-05">5 October 2025</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">R. Barnes</div>
<div class="org">Cisco</div>
</div>
<div class="author">
      <div class="author-name">K. Bhargavan</div>
<div class="org">Inria</div>
</div>
<div class="author">
      <div class="author-name">B. Lipp</div>
<div class="org">Inria</div>
</div>
<div class="author">
      <div class="author-name">C. Wood</div>
<div class="org">Apple</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Hybrid Public Key Encryption</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document describes a scheme for hybrid public key encryption (HPKE).
This scheme provides a variant of public key encryption of arbitrary-sized
plaintexts for a recipient public key. It also includes three authenticated
variants, including one that authenticates possession of a pre-shared key
and two optional ones that authenticate possession of a key encapsulation
mechanism (KEM) private key. HPKE works for any combination of an asymmetric
KEM, key derivation function (KDF), and authenticated encryption with
additional data (AEAD) encryption function. Some authenticated variants may not
be supported by all KEMs. We provide instantiations of the scheme using widely
used and efficient primitives, such as Elliptic Curve Diffie-Hellman (ECDH) key
agreement, HMAC-based key derivation function (HKDF), and SHA2.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
<p id="section-abstract-2">This document is a product of the Crypto Forum Research Group (CFRG) in the IRTF.<a href="#section-abstract-2" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-discussion-venues">
<a href="#name-discussion-venues" class="section-name selfRef">Discussion Venues</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">Source for this draft and an issue tracker can be found at
    <span><a href="https://github.com/hpkewg/hpke">https://github.com/hpkewg/hpke</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 5 October 2025.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2025 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-requirements-notation" class="internal xref">Requirements Notation</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1" class="keepWithNext"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-notation" class="internal xref">Notation</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-cryptographic-dependencies" class="internal xref">Cryptographic Dependencies</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-dh-based-kem-dhkem" class="internal xref">DH-Based KEM (DHKEM)</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-hybrid-public-key-encryptio" class="internal xref">Hybrid Public Key Encryption</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-creating-the-encryption-con" class="internal xref">Creating the Encryption Context</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.1">
                    <p id="section-toc.1-1.5.2.1.2.1.1"><a href="#section-5.1.1" class="auto internal xref">5.1.1</a>.  <a href="#name-encryption-to-a-public-key" class="internal xref">Encryption to a Public Key</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.2">
                    <p id="section-toc.1-1.5.2.1.2.2.1"><a href="#section-5.1.2" class="auto internal xref">5.1.2</a>.  <a href="#name-authentication-using-a-pre-" class="internal xref">Authentication Using a Pre-Shared Key</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.3">
                    <p id="section-toc.1-1.5.2.1.2.3.1"><a href="#section-5.1.3" class="auto internal xref">5.1.3</a>.  <a href="#name-authentication-using-an-asy" class="internal xref">Authentication Using an Asymmetric Key</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.4">
                    <p id="section-toc.1-1.5.2.1.2.4.1"><a href="#section-5.1.4" class="auto internal xref">5.1.4</a>.  <a href="#name-authentication-using-both-a" class="internal xref">Authentication Using Both a PSK and an Asymmetric Key</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-encryption-and-decryption" class="internal xref">Encryption and Decryption</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="auto internal xref">5.3</a>.  <a href="#name-secret-export" class="internal xref">Secret Export</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-single-shot-apis" class="internal xref">Single-Shot APIs</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-encryption-and-decryption-2" class="internal xref">Encryption and Decryption</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="auto internal xref">6.2</a>.  <a href="#name-secret-export-2" class="internal xref">Secret Export</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-algorithm-identifiers" class="internal xref">Algorithm Identifiers</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-key-encapsulation-mechanism" class="internal xref">Key Encapsulation Mechanisms (KEMs)</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1.2.1">
                    <p id="section-toc.1-1.7.2.1.2.1.1"><a href="#section-7.1.1" class="auto internal xref">7.1.1</a>.  <a href="#name-serializepublickey-and-dese" class="internal xref">SerializePublicKey and DeserializePublicKey</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1.2.2">
                    <p id="section-toc.1-1.7.2.1.2.2.1"><a href="#section-7.1.2" class="auto internal xref">7.1.2</a>.  <a href="#name-serializeprivatekey-and-des" class="internal xref">SerializePrivateKey and DeserializePrivateKey</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1.2.3">
                    <p id="section-toc.1-1.7.2.1.2.3.1"><a href="#section-7.1.3" class="auto internal xref">7.1.3</a>.  <a href="#name-derivekeypair" class="internal xref">DeriveKeyPair</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1.2.4">
                    <p id="section-toc.1-1.7.2.1.2.4.1"><a href="#section-7.1.4" class="auto internal xref">7.1.4</a>.  <a href="#name-validation-of-inputs-and-ou" class="internal xref">Validation of Inputs and Outputs</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1.2.5">
                    <p id="section-toc.1-1.7.2.1.2.5.1"><a href="#section-7.1.5" class="auto internal xref">7.1.5</a>.  <a href="#name-future-kems" class="internal xref">Future KEMs</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="auto internal xref">7.2</a>.  <a href="#name-key-derivation-functions-kd" class="internal xref">Key Derivation Functions (KDFs)</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2.2.1">
                    <p id="section-toc.1-1.7.2.2.2.1.1"><a href="#section-7.2.1" class="auto internal xref">7.2.1</a>.  <a href="#name-input-length-restrictions" class="internal xref">Input Length Restrictions</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="auto internal xref">7.3</a>.  <a href="#name-authenticated-encryption-wi" class="internal xref">Authenticated Encryption with Associated Data (AEAD) Functions</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-api-considerations" class="internal xref">API Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="auto internal xref">8.1</a>.  <a href="#name-auxiliary-authenticated-app" class="internal xref">Auxiliary Authenticated Application Information</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="auto internal xref">8.2</a>.  <a href="#name-errors" class="internal xref">Errors</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="auto internal xref">9.1</a>.  <a href="#name-security-properties" class="internal xref">Security Properties</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1.2.1">
                    <p id="section-toc.1-1.9.2.1.2.1.1"><a href="#section-9.1.1" class="auto internal xref">9.1.1</a>.  <a href="#name-key-compromise-impersonatio" class="internal xref">Key-Compromise Impersonation</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1.2.2">
                    <p id="section-toc.1-1.9.2.1.2.2.1"><a href="#section-9.1.2" class="auto internal xref">9.1.2</a>.  <a href="#name-computational-analysis" class="internal xref">Computational Analysis</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1.2.3">
                    <p id="section-toc.1-1.9.2.1.2.3.1"><a href="#section-9.1.3" class="auto internal xref">9.1.3</a>.  <a href="#name-post-quantum-security" class="internal xref">Post-Quantum Security</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="auto internal xref">9.2</a>.  <a href="#name-security-requirements-on-a-" class="internal xref">Security Requirements on a KEM Used within HPKE</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2.2.1">
                    <p id="section-toc.1-1.9.2.2.2.1.1"><a href="#section-9.2.1" class="auto internal xref">9.2.1</a>.  <a href="#name-encap-decap-interface" class="internal xref">Encap/Decap Interface</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2.2.2">
                    <p id="section-toc.1-1.9.2.2.2.2.1"><a href="#section-9.2.2" class="auto internal xref">9.2.2</a>.  <a href="#name-authencap-authdecap-interfa" class="internal xref">AuthEncap/AuthDecap Interface</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2.2.3">
                    <p id="section-toc.1-1.9.2.2.2.3.1"><a href="#section-9.2.3" class="auto internal xref">9.2.3</a>.  <a href="#name-kem-key-reuse" class="internal xref">KEM Key Reuse</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.3">
                <p id="section-toc.1-1.9.2.3.1"><a href="#section-9.3" class="auto internal xref">9.3</a>.  <a href="#name-security-requirements-on-a-k" class="internal xref">Security Requirements on a KDF</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.4">
                <p id="section-toc.1-1.9.2.4.1"><a href="#section-9.4" class="auto internal xref">9.4</a>.  <a href="#name-security-requirements-on-an" class="internal xref">Security Requirements on an AEAD</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.5">
                <p id="section-toc.1-1.9.2.5.1"><a href="#section-9.5" class="auto internal xref">9.5</a>.  <a href="#name-pre-shared-key-recommendati" class="internal xref">Pre-Shared Key Recommendations</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.6">
                <p id="section-toc.1-1.9.2.6.1"><a href="#section-9.6" class="auto internal xref">9.6</a>.  <a href="#name-domain-separation" class="internal xref">Domain Separation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.7">
                <p id="section-toc.1-1.9.2.7.1"><a href="#section-9.7" class="auto internal xref">9.7</a>.  <a href="#name-application-embedding-and-n" class="internal xref">Application Embedding and Non-Goals</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.7.2.1">
                    <p id="section-toc.1-1.9.2.7.2.1.1"><a href="#section-9.7.1" class="auto internal xref">9.7.1</a>.  <a href="#name-message-order-and-message-l" class="internal xref">Message Order and Message Loss</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.7.2.2">
                    <p id="section-toc.1-1.9.2.7.2.2.1"><a href="#section-9.7.2" class="auto internal xref">9.7.2</a>.  <a href="#name-downgrade-prevention" class="internal xref">Downgrade Prevention</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.7.2.3">
                    <p id="section-toc.1-1.9.2.7.2.3.1"><a href="#section-9.7.3" class="auto internal xref">9.7.3</a>.  <a href="#name-replay-protection" class="internal xref">Replay Protection</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.7.2.4">
                    <p id="section-toc.1-1.9.2.7.2.4.1"><a href="#section-9.7.4" class="auto internal xref">9.7.4</a>.  <a href="#name-forward-secrecy" class="internal xref">Forward Secrecy</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.7.2.5">
                    <p id="section-toc.1-1.9.2.7.2.5.1"><a href="#section-9.7.5" class="auto internal xref">9.7.5</a>.  <a href="#name-bad-ephemeral-randomness" class="internal xref">Bad Ephemeral Randomness</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.7.2.6">
                    <p id="section-toc.1-1.9.2.7.2.6.1"><a href="#section-9.7.6" class="auto internal xref">9.7.6</a>.  <a href="#name-hiding-plaintext-length" class="internal xref">Hiding Plaintext Length</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.8">
                <p id="section-toc.1-1.9.2.8.1"><a href="#section-9.8" class="auto internal xref">9.8</a>.  <a href="#name-bidirectional-encryption" class="internal xref">Bidirectional Encryption</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.9">
                <p id="section-toc.1-1.9.2.9.1"><a href="#section-9.9" class="auto internal xref">9.9</a>.  <a href="#name-metadata-protection" class="internal xref">Metadata Protection</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>. <a href="#name-message-encoding" class="internal xref">Message Encoding</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="auto internal xref">11</a>. <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#section-11.1" class="auto internal xref">11.1</a>.  <a href="#name-kem-identifiers" class="internal xref">KEM Identifiers</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#section-11.2" class="auto internal xref">11.2</a>.  <a href="#name-kdf-identifiers" class="internal xref">KDF Identifiers</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.3">
                <p id="section-toc.1-1.11.2.3.1"><a href="#section-11.3" class="auto internal xref">11.3</a>.  <a href="#name-aead-identifiers" class="internal xref">AEAD Identifiers</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="auto internal xref">12</a>. <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.1">
                <p id="section-toc.1-1.12.2.1.1"><a href="#section-12.1" class="auto internal xref">12.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.2">
                <p id="section-toc.1-1.12.2.2.1"><a href="#section-12.2" class="auto internal xref">12.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.  <a href="#name-acknowledgements" class="internal xref">Acknowledgements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#appendix-B" class="auto internal xref">Appendix B</a>.  <a href="#name-test-vectors" class="internal xref">Test Vectors</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#appendix-C" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">Encryption schemes that combine asymmetric and symmetric algorithms have been
specified and practiced since the early days of public key cryptography, e.g.,
<span>[<a href="#RFC1421" class="cite xref">RFC1421</a>]</span>. Combining the two yields the key management advantages of asymmetric
cryptography and the performance benefits of symmetric cryptography. The traditional
combination has been "encrypt the symmetric key with the public key." "Hybrid"
public key encryption (HPKE) schemes, specified here, take a different approach:
"generate the symmetric key and its encapsulation with the public key."
Specifically, encrypted messages convey an encryption key encapsulated with a
public key scheme, along with one or more arbitrary-sized ciphertexts encrypted
using that key. This type of public key encryption has many applications in
practice, including Messaging Layer Security <span>[<a href="#I-D.ietf-mls-protocol" class="cite xref">I-D.ietf-mls-protocol</a>]</span> and
TLS Encrypted ClientHello <span>[<a href="#I-D.ietf-tls-esni" class="cite xref">I-D.ietf-tls-esni</a>]</span>.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">Currently, there are numerous competing and non-interoperable standards and
variants for hybrid encryption, mostly variants on the Elliptic Curve Integrated Encryption Scheme (ECIES), including ANSI X9.63
(ECIES) <span>[<a href="#ANSI" class="cite xref">ANSI</a>]</span>, IEEE 1363a <span>[<a href="#IEEE1363" class="cite xref">IEEE1363</a>]</span>, ISO/IEC 18033-2 <span>[<a href="#ISO" class="cite xref">ISO</a>]</span>, and SECG SEC 1
<span>[<a href="#SECG" class="cite xref">SECG</a>]</span>.  See <span>[<a href="#MAEA10" class="cite xref">MAEA10</a>]</span> for a thorough comparison.  All these existing
schemes have problems, e.g., because they rely on outdated primitives, lack
proofs of indistinguishable (adaptive) chosen-ciphertext attack (IND-CCA2) security, or fail to provide test vectors.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">This document defines an HPKE scheme that provides a subset
of the functions provided by the collection of schemes above but
specified with sufficient clarity that they can be interoperably
implemented. The HPKE construction defined herein is secure against (adaptive)
chosen ciphertext attacks (IND-CCA2-secure) under classical assumptions about
the underlying primitives <span>[<a href="#HPKEAnalysis" class="cite xref">HPKEAnalysis</a>]</span> <span>[<a href="#ABHKLR20" class="cite xref">ABHKLR20</a>]</span>. A summary of
these analyses is in <a href="#sec-properties" class="auto internal xref">Section 9.1</a>.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">This document represents the consensus of the Crypto Forum Research Group (CFRG).<a href="#section-1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="requirements-notation">
<section id="section-2">
      <h2 id="name-requirements-notation">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-requirements-notation" class="section-name selfRef">Requirements Notation</a>
      </h2>
<p id="section-2-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED",
"MAY", and "OPTIONAL" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="notation">
<section id="section-3">
      <h2 id="name-notation">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-notation" class="section-name selfRef">Notation</a>
      </h2>
<p id="section-3-1">The following terms are used throughout this document to describe the
operations, roles, and behaviors of HPKE:<a href="#section-3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3-2.1">
          <p id="section-3-2.1.1"><code>(skX, pkX)</code>: A key encapsulation mechanism (KEM) key pair used in role X,
where X is one of S, R, or E as sender, recipient, and ephemeral, respectively;
<code>skX</code> is the private key and <code>pkX</code> is the public key.<a href="#section-3-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-3-2.2">
          <p id="section-3-2.2.1"><code>pk(skX)</code>: The KEM public key corresponding to the KEM private key <code>skX</code>.<a href="#section-3-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-3-2.3">
          <p id="section-3-2.3.1">Sender (S): Role of entity that sends an encrypted message.<a href="#section-3-2.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-3-2.4">
          <p id="section-3-2.4.1">Recipient (R): Role of entity that receives an encrypted message.<a href="#section-3-2.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-3-2.5">
          <p id="section-3-2.5.1">Ephemeral (E): Role of a fresh random value meant for one-time use.<a href="#section-3-2.5.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-3-2.6">
          <p id="section-3-2.6.1"><code>I2OSP(n, w)</code>: Convert non-negative integer <code>n</code> to a <code>w</code>-length,
big-endian byte string, as described in <span>[<a href="#RFC8017" class="cite xref">RFC8017</a>]</span>.<a href="#section-3-2.6.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-3-2.7">
          <p id="section-3-2.7.1"><code>OS2IP(x)</code>: Convert byte string <code>x</code> to a non-negative integer, as
described in <span>[<a href="#RFC8017" class="cite xref">RFC8017</a>]</span>, assuming big-endian byte order.<a href="#section-3-2.7.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-3-2.8">
          <p id="section-3-2.8.1"><code>concat(x0, ..., xN)</code>: Concatenation of byte strings.
<code>concat(0x01, 0x0203, 0x040506) = 0x010203040506</code>.<a href="#section-3-2.8.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-3-2.9">
          <p id="section-3-2.9.1"><code>random(n)</code>: A pseudorandom byte string of length <code>n</code> bytes<a href="#section-3-2.9.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-3-2.10">
          <p id="section-3-2.10.1"><code>xor(a,b)</code>: XOR of byte strings; <code>xor(0xF0F0, 0x1234) = 0xE2C4</code>.
It is an error to call this function with two arguments of unequal
length.<a href="#section-3-2.10.1" class="pilcrow">¶</a></p>
</li>
      </ul>
</section>
</div>
<div id="base-crypto">
<section id="section-4">
      <h2 id="name-cryptographic-dependencies">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-cryptographic-dependencies" class="section-name selfRef">Cryptographic Dependencies</a>
      </h2>
<p id="section-4-1">HPKE variants rely on the following primitives:<a href="#section-4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-2.1">
          <p id="section-4-2.1.1">A key encapsulation mechanism (KEM):<a href="#section-4-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-2.1.2.1">
              <p id="section-4-2.1.2.1.1"><code>GenerateKeyPair()</code>: Randomized algorithm to generate a key pair <code>(skX, pkX)</code>.<a href="#section-4-2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4-2.1.2.2">
              <p id="section-4-2.1.2.2.1"><code>DeriveKeyPair(ikm)</code>: Deterministic algorithm to derive a key pair
<code>(skX, pkX)</code> from the byte string <code>ikm</code>, where <code>ikm</code> SHOULD have at
least <code>Nsk</code> bytes of entropy (see <a href="#derive-key-pair" class="auto internal xref">Section 7.1.3</a> for discussion).<a href="#section-4-2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4-2.1.2.3">
              <p id="section-4-2.1.2.3.1"><code>SerializePublicKey(pkX)</code>: Produce a byte string of length <code>Npk</code> encoding the
public key <code>pkX</code>.<a href="#section-4-2.1.2.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4-2.1.2.4">
              <p id="section-4-2.1.2.4.1"><code>DeserializePublicKey(pkXm)</code>: Parse a byte string of length <code>Npk</code> to recover a
public key. This function can raise a <code>DeserializeError</code> error upon <code>pkXm</code>
deserialization failure.<a href="#section-4-2.1.2.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4-2.1.2.5">
              <p id="section-4-2.1.2.5.1"><code>Encap(pkR)</code>: Randomized algorithm to generate an ephemeral,
fixed-length symmetric key (the KEM shared secret) and
a fixed-length encapsulation of that key that can be decapsulated
by the holder of the private key corresponding to <code>pkR</code>. This function
can raise an <code>EncapError</code> on encapsulation failure.<a href="#section-4-2.1.2.5.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4-2.1.2.6">
              <p id="section-4-2.1.2.6.1"><code>Decap(enc, skR)</code>: Deterministic algorithm using the private key <code>skR</code>
to recover the ephemeral symmetric key (the KEM shared secret) from
its encapsulated representation <code>enc</code>. This function can raise a
<code>DecapError</code> on decapsulation failure.<a href="#section-4-2.1.2.6.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4-2.1.2.7">
              <p id="section-4-2.1.2.7.1"><code>AuthEncap(pkR, skS)</code> (optional): Same as <code>Encap()</code>, and the outputs
encode an assurance that the KEM shared secret was generated by the
holder of the private key <code>skS</code>.<a href="#section-4-2.1.2.7.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4-2.1.2.8">
              <p id="section-4-2.1.2.8.1"><code>AuthDecap(enc, skR, pkS)</code> (optional): Same as <code>Decap()</code>, and the recipient
is assured that the KEM shared secret was generated by the holder of
the private key <code>skS</code>.<a href="#section-4-2.1.2.8.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4-2.1.2.9">
              <p id="section-4-2.1.2.9.1"><code>Nsecret</code>: The length in bytes of a KEM shared secret produced by this KEM.<a href="#section-4-2.1.2.9.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4-2.1.2.10">
              <p id="section-4-2.1.2.10.1"><code>Nenc</code>: The length in bytes of an encapsulated key produced by this KEM.<a href="#section-4-2.1.2.10.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4-2.1.2.11">
              <p id="section-4-2.1.2.11.1"><code>Npk</code>: The length in bytes of an encoded public key for this KEM.<a href="#section-4-2.1.2.11.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4-2.1.2.12">
              <p id="section-4-2.1.2.12.1"><code>Nsk</code>: The length in bytes of an encoded private key for this KEM.<a href="#section-4-2.1.2.12.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</li>
        <li class="normal" id="section-4-2.2">
          <p id="section-4-2.2.1">A key derivation function (KDF):<a href="#section-4-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-2.2.2.1">
              <p id="section-4-2.2.2.1.1"><code>Extract(salt, ikm)</code>: Extract a pseudorandom key of fixed length <code>Nh</code> bytes
from input keying material <code>ikm</code> and an optional byte string
<code>salt</code>.<a href="#section-4-2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4-2.2.2.2">
              <p id="section-4-2.2.2.2.1"><code>Expand(prk, info, L)</code>: Expand a pseudorandom key <code>prk</code> using
optional string <code>info</code> into <code>L</code> bytes of output keying material.<a href="#section-4-2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4-2.2.2.3">
              <p id="section-4-2.2.2.3.1"><code>Nh</code>: The output size of the <code>Extract()</code> function in bytes.<a href="#section-4-2.2.2.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</li>
        <li class="normal" id="section-4-2.3">
          <p id="section-4-2.3.1">An AEAD encryption algorithm <span>[<a href="#RFC5116" class="cite xref">RFC5116</a>]</span>:<a href="#section-4-2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-2.3.2.1">
              <p id="section-4-2.3.2.1.1"><code>Seal(key, nonce, aad, pt)</code>: Encrypt and authenticate plaintext
<code>pt</code> with associated data <code>aad</code> using symmetric key <code>key</code> and nonce
<code>nonce</code>, yielding ciphertext and tag <code>ct</code>. This function
 can raise a <code>MessageLimitReachedError</code> upon failure.<a href="#section-4-2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4-2.3.2.2">
              <p id="section-4-2.3.2.2.1"><code>Open(key, nonce, aad, ct)</code>: Decrypt ciphertext and tag <code>ct</code> using
associated data <code>aad</code> with symmetric key <code>key</code> and nonce <code>nonce</code>,
returning plaintext message <code>pt</code>. This function can raise an
<code>OpenError</code> or <code>MessageLimitReachedError</code> upon failure.<a href="#section-4-2.3.2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4-2.3.2.3">
              <p id="section-4-2.3.2.3.1"><code>Nk</code>: The length in bytes of a key for this algorithm.<a href="#section-4-2.3.2.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4-2.3.2.4">
              <p id="section-4-2.3.2.4.1"><code>Nn</code>: The length in bytes of a nonce for this algorithm.<a href="#section-4-2.3.2.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4-2.3.2.5">
              <p id="section-4-2.3.2.5.1"><code>Nt</code>: The length in bytes of the authentication tag for this algorithm.<a href="#section-4-2.3.2.5.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</li>
      </ul>
<p id="section-4-3">Beyond the above, a KEM MAY also expose the following functions, whose behavior
is detailed in <a href="#serializeprivatekey" class="auto internal xref">Section 7.1.2</a>:<a href="#section-4-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-4.1">
          <p id="section-4-4.1.1"><code>SerializePrivateKey(skX)</code>: Produce a byte string of length <code>Nsk</code> encoding the private
key <code>skX</code>.<a href="#section-4-4.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-4.2">
          <p id="section-4-4.2.1"><code>DeserializePrivateKey(skXm)</code>: Parse a byte string of length <code>Nsk</code> to recover a
private key. This function can raise a <code>DeserializeError</code> error upon <code>skXm</code>
deserialization failure.<a href="#section-4-4.2.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-4-5">A <em>ciphersuite</em> is a triple (KEM, KDF, AEAD) containing a choice of algorithm
for each primitive.<a href="#section-4-5" class="pilcrow">¶</a></p>
<p id="section-4-6">A set of algorithm identifiers for concrete instantiations of these
primitives is provided in <a href="#ciphersuites" class="auto internal xref">Section 7</a>.  Algorithm identifier
values are two bytes long.<a href="#section-4-6" class="pilcrow">¶</a></p>
<p id="section-4-7">Note that <code>GenerateKeyPair</code> can be implemented as <code>DeriveKeyPair(random(Nsk))</code>.<a href="#section-4-7" class="pilcrow">¶</a></p>
<p id="section-4-8">The notation <code>pk(skX)</code>, depending on its use and the KEM and its
implementation, is either the
computation of the public key using the private key, or just syntax
expressing the retrieval of the public key, assuming it is stored along
with the private key object.<a href="#section-4-8" class="pilcrow">¶</a></p>
<p id="section-4-9">The following two functions are defined to facilitate domain separation of
KDF calls as well as context binding:<a href="#section-4-9" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4-10">
<pre>
def LabeledExtract(salt, label, ikm):
  labeled_ikm = concat("HPKE-v1", suite_id, label, ikm)
  return Extract(salt, labeled_ikm)

def LabeledExpand(prk, label, info, L):
  labeled_info = concat(I2OSP(L, 2), "HPKE-v1", suite_id,
                        label, info)
  return Expand(prk, labeled_info, L)
</pre><a href="#section-4-10" class="pilcrow">¶</a>
</div>
<p id="section-4-11">The value of <code>suite_id</code> depends on where the KDF is used; it is assumed
implicit from the implementation and not passed as a parameter. If used
inside a KEM algorithm, <code>suite_id</code> MUST start with "KEM" and identify
this KEM algorithm; if used in the remainder of HPKE, it MUST start with
"HPKE" and identify the entire ciphersuite in use. See sections <a href="#dhkem" class="auto internal xref">Section 4.1</a>
and <a href="#encryption-context" class="auto internal xref">Section 5.1</a> for details.<a href="#section-4-11" class="pilcrow">¶</a></p>
<div id="dhkem">
<section id="section-4.1">
        <h3 id="name-dh-based-kem-dhkem">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-dh-based-kem-dhkem" class="section-name selfRef">DH-Based KEM (DHKEM)</a>
        </h3>
<p id="section-4.1-1">Suppose we are given a KDF, and a Diffie-Hellman (DH) group providing the
following operations:<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-2.1">
            <p id="section-4.1-2.1.1"><code>DH(skX, pkY)</code>: Perform a non-interactive Diffie-Hellman exchange using
the private key <code>skX</code> and public key <code>pkY</code> to produce a Diffie-Hellman shared
secret of length <code>Ndh</code>. This function can raise a <code>ValidationError</code> as described
in <a href="#validation" class="auto internal xref">Section 7.1.4</a>.<a href="#section-4.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.1-2.2">
            <p id="section-4.1-2.2.1"><code>Ndh</code>: The length in bytes of a Diffie-Hellman shared secret produced
by <code>DH()</code>.<a href="#section-4.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.1-2.3">
            <p id="section-4.1-2.3.1"><code>Nsk</code>: The length in bytes of a Diffie-Hellman private key.<a href="#section-4.1-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.1-3">Then we can construct a KEM that implements the interface defined in <a href="#base-crypto" class="auto internal xref">Section 4</a>
called <code>DHKEM(Group, KDF)</code> in the following way, where <code>Group</code> denotes the
Diffie-Hellman group and <code>KDF</code> denotes the KDF. The function parameters <code>pkR</code> and <code>pkS</code>
are deserialized public keys, and <code>enc</code> is a serialized public key. Since
encapsulated keys are Diffie-Hellman public keys in this KEM algorithm,
we use <code>SerializePublicKey()</code> and <code>DeserializePublicKey()</code> to encode and decode
them, respectively. <code>Npk</code> equals <code>Nenc</code>. <code>GenerateKeyPair()</code> produces a key pair
for the Diffie-Hellman group in use. <a href="#derive-key-pair" class="auto internal xref">Section 7.1.3</a> contains the
<code>DeriveKeyPair()</code> function specification for DHKEMs defined in this document.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.1-4">
<pre>
def ExtractAndExpand(dh, kem_context):
  eae_prk = LabeledExtract("", "eae_prk", dh)
  shared_secret = LabeledExpand(eae_prk, "shared_secret",
                                kem_context, Nsecret)
  return shared_secret

def Encap(pkR):
  skE, pkE = GenerateKeyPair()
  dh = DH(skE, pkR)
  enc = SerializePublicKey(pkE)

  pkRm = SerializePublicKey(pkR)
  kem_context = concat(enc, pkRm)

  shared_secret = ExtractAndExpand(dh, kem_context)
  return shared_secret, enc

def Decap(enc, skR):
  pkE = DeserializePublicKey(enc)
  dh = DH(skR, pkE)

  pkRm = SerializePublicKey(pk(skR))
  kem_context = concat(enc, pkRm)

  shared_secret = ExtractAndExpand(dh, kem_context)
  return shared_secret

def AuthEncap(pkR, skS):
  skE, pkE = GenerateKeyPair()
  dh = concat(DH(skE, pkR), DH(skS, pkR))
  enc = SerializePublicKey(pkE)

  pkRm = SerializePublicKey(pkR)
  pkSm = SerializePublicKey(pk(skS))
  kem_context = concat(enc, pkRm, pkSm)

  shared_secret = ExtractAndExpand(dh, kem_context)
  return shared_secret, enc

def AuthDecap(enc, skR, pkS):
  pkE = DeserializePublicKey(enc)
  dh = concat(DH(skR, pkE), DH(skR, pkS))

  pkRm = SerializePublicKey(pk(skR))
  pkSm = SerializePublicKey(pkS)
  kem_context = concat(enc, pkRm, pkSm)

  shared_secret = ExtractAndExpand(dh, kem_context)
  return shared_secret
</pre><a href="#section-4.1-4" class="pilcrow">¶</a>
</div>
<p id="section-4.1-5">The implicit <code>suite_id</code> value used within <code>LabeledExtract</code> and
<code>LabeledExpand</code> is defined as follows, where <code>kem_id</code> is defined
in <a href="#kem-ids" class="auto internal xref">Section 7.1</a>:<a href="#section-4.1-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.1-6">
<pre>
suite_id = concat("KEM", I2OSP(kem_id, 2))
</pre><a href="#section-4.1-6" class="pilcrow">¶</a>
</div>
<p id="section-4.1-7">The KDF used in DHKEM can be equal to or different from the KDF used
in the remainder of HPKE, depending on the chosen variant.
Implementations MUST make sure to use the constants (<code>Nh</code>) and function
calls (<code>LabeledExtract</code> and <code>LabeledExpand</code>) of the appropriate KDF when
implementing DHKEM. See <a href="#kdf-choice" class="auto internal xref">Section 9.3</a> for a comment on the choice of
a KDF for the remainder of HPKE, and <a href="#domain-separation" class="auto internal xref">Section 9.6</a> for the
rationale of the labels.<a href="#section-4.1-7" class="pilcrow">¶</a></p>
<p id="section-4.1-8">For the variants of DHKEM defined in this document, the size <code>Nsecret</code> of the
KEM shared secret is equal to the output length of the hash function
underlying the KDF. For P-256, P-384, and P-521, the size <code>Ndh</code> of the
Diffie-Hellman shared secret is equal to 32, 48, and 66, respectively,
corresponding to the x-coordinate of the resulting elliptic curve point <span>[<a href="#IEEE1363" class="cite xref">IEEE1363</a>]</span>.
For X25519 and X448, the size <code>Ndh</code> is equal to 32 and 56, respectively
(see <span>[<a href="#RFC7748" class="cite xref">RFC7748</a>]</span>, Section 5).<a href="#section-4.1-8" class="pilcrow">¶</a></p>
<p id="section-4.1-9">It is important to note that the <code>AuthEncap()</code> and <code>AuthDecap()</code> functions of the
DHKEM variants defined in this document are vulnerable to key-compromise
impersonation (KCI). This means the assurance that the KEM shared secret
was generated by the holder of the private key <code>skS</code> does not hold if
the recipient private key <code>skR</code> is compromised. See <a href="#sec-properties" class="auto internal xref">Section 9.1</a>
for more details.<a href="#section-4.1-9" class="pilcrow">¶</a></p>
<p id="section-4.1-10">Senders and recipients MUST validate KEM inputs and outputs as described
in <a href="#kem-ids" class="auto internal xref">Section 7.1</a>.<a href="#section-4.1-10" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="hpke">
<section id="section-5">
      <h2 id="name-hybrid-public-key-encryptio">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-hybrid-public-key-encryptio" class="section-name selfRef">Hybrid Public Key Encryption</a>
      </h2>
<p id="section-5-1">In this section, we define a few HPKE variants.  All variants take a
recipient public key and a sequence of plaintexts <code>pt</code> and produce an
encapsulated key <code>enc</code> and a sequence of ciphertexts <code>ct</code>.  These outputs are
constructed so that only the holder of <code>skR</code> can decapsulate the key from
<code>enc</code> and decrypt the ciphertexts.  All the algorithms also take an
<code>info</code> parameter that can be used to influence the generation of keys
(e.g., to fold in identity information) and an <code>aad</code> parameter that
provides additional authenticated data to the AEAD algorithm in use.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">In addition to the base case of encrypting to a public key, we
include three authenticated variants: one that authenticates
possession of a pre-shared key, one that authenticates
possession of a KEM private key, and one that authenticates possession of both
a pre-shared key and a KEM private key. All authenticated variants contribute
additional keying material to the encryption operation. The following one-byte
values will be used to distinguish between modes:<a href="#section-5-2" class="pilcrow">¶</a></p>
<span id="name-hpke-modes"></span><div id="hpke-modes">
<table class="center" id="table-1">
        <caption>
<a href="#table-1" class="selfRef">Table 1</a>:
<a href="#name-hpke-modes" class="selfRef">HPKE Modes</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" rowspan="1" colspan="1">Mode</th>
            <th class="text-left" rowspan="1" colspan="1">Value</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">mode_base</td>
            <td class="text-left" rowspan="1" colspan="1">0x00</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">mode_psk</td>
            <td class="text-left" rowspan="1" colspan="1">0x01</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">mode_auth</td>
            <td class="text-left" rowspan="1" colspan="1">0x02</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">mode_auth_psk</td>
            <td class="text-left" rowspan="1" colspan="1">0x03</td>
          </tr>
        </tbody>
      </table>
</div>
<p id="section-5-4">All these cases follow the same basic two-step pattern:<a href="#section-5-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5-5">
<li id="section-5-5.1">
          <p id="section-5-5.1.1">Set up an encryption context that is shared between the sender
and the recipient.<a href="#section-5-5.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-5-5.2">
          <p id="section-5-5.2.1">Use that context to encrypt or decrypt content.<a href="#section-5-5.2.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<p id="section-5-6">A <em>context</em> is an implementation-specific structure that encodes
the AEAD algorithm and key in use, and manages the nonces used so
that the same nonce is not used with multiple plaintexts. It also
has an interface for exporting secret values, as described in
<a href="#hpke-export" class="auto internal xref">Section 5.3</a>. See <a href="#hpke-dem" class="auto internal xref">Section 5.2</a> for a description of this structure
and its interfaces. HPKE decryption fails when the underlying AEAD
decryption fails.<a href="#section-5-6" class="pilcrow">¶</a></p>
<p id="section-5-7">The constructions described here presume that the relevant non-private
parameters (<code>enc</code>, <code>psk_id</code>, etc.) are transported between the sender and the
recipient by some application making use of HPKE. Moreover, a recipient with more
than one public key needs some way of determining which of its public keys was
used for the encapsulation operation. As an example, applications may send this
information alongside a ciphertext from the sender to the recipient. Specification of
such a mechanism is left to the application. See <a href="#message-encoding" class="auto internal xref">Section 10</a> for more
details.<a href="#section-5-7" class="pilcrow">¶</a></p>
<p id="section-5-8">Note that some KEMs may not support <code>AuthEncap()</code> or <code>AuthDecap()</code>.
For such KEMs, only <code>mode_base</code> or <code>mode_psk</code> are supported. Future specifications
which define new KEMs MUST indicate whether these modes are supported.
See <a href="#future-kems" class="auto internal xref">Section 7.1.5</a> for more details.<a href="#section-5-8" class="pilcrow">¶</a></p>
<p id="section-5-9">The procedures described in this section are laid out in a
Python-like pseudocode. The algorithms in use are left implicit.<a href="#section-5-9" class="pilcrow">¶</a></p>
<div id="encryption-context">
<section id="section-5.1">
        <h3 id="name-creating-the-encryption-con">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-creating-the-encryption-con" class="section-name selfRef">Creating the Encryption Context</a>
        </h3>
<p id="section-5.1-1">The variants of HPKE defined in this document share a common
key schedule that translates the protocol inputs into an encryption
context. The key schedule inputs are as follows:<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-2.1">
            <p id="section-5.1-2.1.1"><code>mode</code> - A one-byte value indicating the HPKE mode, defined in <a href="#hpke-modes" class="auto internal xref">Table 1</a>.<a href="#section-5.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.1-2.2">
            <p id="section-5.1-2.2.1"><code>shared_secret</code> - A KEM shared secret generated for this transaction.<a href="#section-5.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.1-2.3">
            <p id="section-5.1-2.3.1"><code>info</code> - Application-supplied information (optional; default value
"").<a href="#section-5.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.1-2.4">
            <p id="section-5.1-2.4.1"><code>psk</code> - A pre-shared key (PSK) held by both the sender
and the recipient (optional; default value "").<a href="#section-5.1-2.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.1-2.5">
            <p id="section-5.1-2.5.1"><code>psk_id</code> - An identifier for the PSK (optional; default value "").<a href="#section-5.1-2.5.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-5.1-3">Senders and recipients MUST validate KEM inputs and outputs as described
in <a href="#kem-ids" class="auto internal xref">Section 7.1</a>.<a href="#section-5.1-3" class="pilcrow">¶</a></p>
<p id="section-5.1-4">The <code>psk</code> and <code>psk_id</code> fields MUST appear together or not at all.
That is, if a non-default value is provided for one of them, then
the other MUST be set to a non-default value. This requirement is
encoded in <code>VerifyPSKInputs()</code> below.<a href="#section-5.1-4" class="pilcrow">¶</a></p>
<p id="section-5.1-5">The <code>psk</code>, <code>psk_id</code>, and <code>info</code> fields have maximum lengths that depend
on the KDF itself, on the definition of <code>LabeledExtract()</code>, and on the
constant labels used together with them. See <a href="#kdf-input-length" class="auto internal xref">Section 7.2.1</a> for
precise limits on these lengths.<a href="#section-5.1-5" class="pilcrow">¶</a></p>
<p id="section-5.1-6">The <code>key</code>, <code>base_nonce</code>, and <code>exporter_secret</code> computed by the key schedule
have the property that they are only known to the holder of the recipient
private key, and the entity that used the KEM to generate <code>shared_secret</code> and
<code>enc</code>.<a href="#section-5.1-6" class="pilcrow">¶</a></p>
<p id="section-5.1-7">In the Auth and AuthPSK modes, the recipient is assured that the sender
held the private key <code>skS</code>. This assurance is limited for the DHKEM
variants defined in this document because of key-compromise impersonation,
as described in <a href="#dhkem" class="auto internal xref">Section 4.1</a> and <a href="#sec-properties" class="auto internal xref">Section 9.1</a>. If in the PSK and
AuthPSK modes, the <code>psk</code> and <code>psk_id</code> arguments are provided as required,
then the recipient is assured that the sender held the corresponding
pre-shared key. See <a href="#sec-properties" class="auto internal xref">Section 9.1</a> for more details.<a href="#section-5.1-7" class="pilcrow">¶</a></p>
<p id="section-5.1-8">The HPKE algorithm identifiers, i.e., the KEM <code>kem_id</code>, KDF <code>kdf_id</code>, and
AEAD <code>aead_id</code> 2-byte code points, as defined in <a href="#kemid-values" class="auto internal xref">Table 2</a>, <a href="#kdfid-values" class="auto internal xref">Table 3</a>,
and <a href="#aeadid-values" class="auto internal xref">Table 5</a>, respectively, are assumed implicit from the implementation
and not passed as parameters. The implicit <code>suite_id</code> value used within
<code>LabeledExtract</code> and <code>LabeledExpand</code> is defined based on them as follows:<a href="#section-5.1-8" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.1-9">
<pre>
suite_id = concat(
  "HPKE",
  I2OSP(kem_id, 2),
  I2OSP(kdf_id, 2),
  I2OSP(aead_id, 2)
)
</pre><a href="#section-5.1-9" class="pilcrow">¶</a>
</div>
<div class="alignLeft art-text artwork" id="section-5.1-10">
<pre>
default_psk = ""
default_psk_id = ""

def VerifyPSKInputs(mode, psk, psk_id):
  got_psk = (psk != default_psk)
  got_psk_id = (psk_id != default_psk_id)
  if got_psk != got_psk_id:
    raise Exception("Inconsistent PSK inputs")

  if got_psk and (mode in [mode_base, mode_auth]):
    raise Exception("PSK input provided when not needed")
  if (not got_psk) and (mode in [mode_psk, mode_auth_psk]):
    raise Exception("Missing required PSK input")

def KeySchedule&lt;ROLE&gt;(mode, shared_secret, info, psk, psk_id):
  VerifyPSKInputs(mode, psk, psk_id)

  psk_id_hash = LabeledExtract("", "psk_id_hash", psk_id)
  info_hash = LabeledExtract("", "info_hash", info)
  key_schedule_context = concat(mode, psk_id_hash, info_hash)

  secret = LabeledExtract(shared_secret, "secret", psk)

  key = LabeledExpand(secret, "key", key_schedule_context, Nk)
  base_nonce = LabeledExpand(secret, "base_nonce",
                             key_schedule_context, Nn)
  exporter_secret = LabeledExpand(secret, "exp",
                                  key_schedule_context, Nh)

  return Context&lt;ROLE&gt;(key, base_nonce, 0, exporter_secret)
</pre><a href="#section-5.1-10" class="pilcrow">¶</a>
</div>
<p id="section-5.1-11">The <code>ROLE</code> template parameter is either S or R, depending on the role of
sender or recipient, respectively. See <a href="#hpke-dem" class="auto internal xref">Section 5.2</a> for a discussion of the
key schedule output, including the role-specific <code>Context</code> structure and its API.<a href="#section-5.1-11" class="pilcrow">¶</a></p>
<p id="section-5.1-12">Note that the <code>key_schedule_context</code> construction in <code>KeySchedule()</code> is
equivalent to serializing a structure of the following form in the TLS presentation
syntax:<a href="#section-5.1-12" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.1-13">
<pre>
struct {
    uint8 mode;
    opaque psk_id_hash[Nh];
    opaque info_hash[Nh];
} KeyScheduleContext;
</pre><a href="#section-5.1-13" class="pilcrow">¶</a>
</div>
<div id="hpke-kem">
<section id="section-5.1.1">
          <h4 id="name-encryption-to-a-public-key">
<a href="#section-5.1.1" class="section-number selfRef">5.1.1. </a><a href="#name-encryption-to-a-public-key" class="section-name selfRef">Encryption to a Public Key</a>
          </h4>
<p id="section-5.1.1-1">The most basic function of an HPKE scheme is to enable encryption
to the holder of a given KEM private key.  The <code>SetupBaseS()</code> and
<code>SetupBaseR()</code> procedures establish contexts that can be used to
encrypt and decrypt, respectively, for a given private key.<a href="#section-5.1.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1.1-2">The KEM shared secret is combined via the KDF
with information describing the key exchange, as well as the
explicit <code>info</code> parameter provided by the caller.<a href="#section-5.1.1-2" class="pilcrow">¶</a></p>
<p id="section-5.1.1-3">The parameter <code>pkR</code> is a public key, and <code>enc</code> is an encapsulated
KEM shared secret.<a href="#section-5.1.1-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.1.1-4">
<pre>
def SetupBaseS(pkR, info):
  shared_secret, enc = Encap(pkR)
  return enc, KeyScheduleS(mode_base, shared_secret, info,
                           default_psk, default_psk_id)

def SetupBaseR(enc, skR, info):
  shared_secret = Decap(enc, skR)
  return KeyScheduleR(mode_base, shared_secret, info,
                      default_psk, default_psk_id)
</pre><a href="#section-5.1.1-4" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="mode-psk">
<section id="section-5.1.2">
          <h4 id="name-authentication-using-a-pre-">
<a href="#section-5.1.2" class="section-number selfRef">5.1.2. </a><a href="#name-authentication-using-a-pre-" class="section-name selfRef">Authentication Using a Pre-Shared Key</a>
          </h4>
<p id="section-5.1.2-1">This variant extends the base mechanism by allowing the recipient to
authenticate that the sender possessed a given PSK. The PSK also
improves confidentiality guarantees in certain adversary models, as
described in more detail in <a href="#sec-properties" class="auto internal xref">Section 9.1</a>. We assume that both
parties have been provisioned with both the PSK value <code>psk</code> and another
byte string <code>psk_id</code> that is used to identify which PSK should be used.<a href="#section-5.1.2-1" class="pilcrow">¶</a></p>
<p id="section-5.1.2-2">The primary difference from the base case is that the <code>psk</code> and <code>psk_id</code> values
are used as <code>ikm</code> inputs to the KDF (instead of using the empty string).<a href="#section-5.1.2-2" class="pilcrow">¶</a></p>
<p id="section-5.1.2-3">The PSK MUST have at least 32 bytes of entropy and SHOULD be of length <code>Nh</code>
bytes or longer. See <a href="#security-psk" class="auto internal xref">Section 9.5</a> for a more detailed discussion.<a href="#section-5.1.2-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.1.2-4">
<pre>
def SetupPSKS(pkR, info, psk, psk_id):
  shared_secret, enc = Encap(pkR)
  return enc, KeyScheduleS(mode_psk, shared_secret, info, psk, psk_id)

def SetupPSKR(enc, skR, info, psk, psk_id):
  shared_secret = Decap(enc, skR)
  return KeyScheduleR(mode_psk, shared_secret, info, psk, psk_id)
</pre><a href="#section-5.1.2-4" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="mode-auth">
<section id="section-5.1.3">
          <h4 id="name-authentication-using-an-asy">
<a href="#section-5.1.3" class="section-number selfRef">5.1.3. </a><a href="#name-authentication-using-an-asy" class="section-name selfRef">Authentication Using an Asymmetric Key</a>
          </h4>
<p id="section-5.1.3-1">This variant extends the base mechanism by allowing the recipient
to authenticate that the sender possessed a given KEM private key.
This is because <code>AuthDecap(enc, skR, pkS)</code> produces the correct KEM
shared secret only if the encapsulated value <code>enc</code> was produced by
<code>AuthEncap(pkR, skS)</code>, where <code>skS</code> is the private key corresponding
to <code>pkS</code>.  In other words, at most two entities (precisely two, in the case
of DHKEM) could have produced this secret, so if the recipient is at most one, then
the sender is the other with overwhelming probability.<a href="#section-5.1.3-1" class="pilcrow">¶</a></p>
<p id="section-5.1.3-2">The primary difference from the base case is that the calls to
<code>Encap()</code> and <code>Decap()</code> are replaced with calls to <code>AuthEncap()</code> and
<code>AuthDecap()</code>, which add the sender public key to their internal
context string. The function parameters <code>pkR</code> and <code>pkS</code> are
public keys, and <code>enc</code> is an encapsulated KEM shared secret.<a href="#section-5.1.3-2" class="pilcrow">¶</a></p>
<p id="section-5.1.3-3">Obviously, this variant can only be used with a KEM that provides
<code>AuthEncap()</code> and <code>AuthDecap()</code> procedures.<a href="#section-5.1.3-3" class="pilcrow">¶</a></p>
<p id="section-5.1.3-4">This mechanism authenticates only the key pair of the sender, not
any other identifier.  If an application wishes to bind HPKE
ciphertexts or exported secrets to another identity for the sender
(e.g., an email address or domain name), then this identifier should be
included in the <code>info</code> parameter to avoid identity misbinding issues <span>[<a href="#IMB" class="cite xref">IMB</a>]</span>.<a href="#section-5.1.3-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.1.3-5">
<pre>
def SetupAuthS(pkR, info, skS):
  shared_secret, enc = AuthEncap(pkR, skS)
  return enc, KeyScheduleS(mode_auth, shared_secret, info,
                           default_psk, default_psk_id)

def SetupAuthR(enc, skR, info, pkS):
  shared_secret = AuthDecap(enc, skR, pkS)
  return KeyScheduleR(mode_auth, shared_secret, info,
                      default_psk, default_psk_id)
</pre><a href="#section-5.1.3-5" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="mode-auth-psk">
<section id="section-5.1.4">
          <h4 id="name-authentication-using-both-a">
<a href="#section-5.1.4" class="section-number selfRef">5.1.4. </a><a href="#name-authentication-using-both-a" class="section-name selfRef">Authentication Using Both a PSK and an Asymmetric Key</a>
          </h4>
<p id="section-5.1.4-1">This mode is a straightforward combination of the PSK and authenticated modes.
Like the PSK mode, a PSK is provided as input to the key schedule, and like the
authenticated mode, authenticated KEM variants are used.<a href="#section-5.1.4-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.1.4-2">
<pre>
def SetupAuthPSKS(pkR, info, psk, psk_id, skS):
  shared_secret, enc = AuthEncap(pkR, skS)
  return enc, KeyScheduleS(mode_auth_psk, shared_secret, info,
                           psk, psk_id)

def SetupAuthPSKR(enc, skR, info, psk, psk_id, pkS):
  shared_secret = AuthDecap(enc, skR, pkS)
  return KeyScheduleR(mode_auth_psk, shared_secret, info,
                      psk, psk_id)
</pre><a href="#section-5.1.4-2" class="pilcrow">¶</a>
</div>
<p id="section-5.1.4-3">The PSK MUST have at least 32 bytes of entropy and SHOULD be of length <code>Nh</code>
bytes or longer. See <a href="#security-psk" class="auto internal xref">Section 9.5</a> for a more detailed discussion.<a href="#section-5.1.4-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="hpke-dem">
<section id="section-5.2">
        <h3 id="name-encryption-and-decryption">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-encryption-and-decryption" class="section-name selfRef">Encryption and Decryption</a>
        </h3>
<p id="section-5.2-1">HPKE allows multiple encryption operations to be done based on a
given setup transaction.  Since the public key operations involved
in setup are typically more expensive than symmetric encryption or
decryption, this allows applications to amortize the cost of the
public key operations, reducing the overall overhead.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">In order to avoid nonce reuse, however, this encryption must be
stateful. Each of the setup procedures above produces a role-specific
context object that stores the AEAD and secret export parameters.
The AEAD parameters consist of:<a href="#section-5.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2-3.1">
            <p id="section-5.2-3.1.1">The AEAD algorithm in use<a href="#section-5.2-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.2-3.2">
            <p id="section-5.2-3.2.1">A secret <code>key</code><a href="#section-5.2-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.2-3.3">
            <p id="section-5.2-3.3.1">A base nonce <code>base_nonce</code><a href="#section-5.2-3.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.2-3.4">
            <p id="section-5.2-3.4.1">A sequence number (initially 0)<a href="#section-5.2-3.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-5.2-4">The secret export parameters consist of:<a href="#section-5.2-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2-5.1">
            <p id="section-5.2-5.1.1">The HPKE ciphersuite in use and<a href="#section-5.2-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.2-5.2">
            <p id="section-5.2-5.2.1">An <code>exporter_secret</code> used for the secret export interface (see
<a href="#hpke-export" class="auto internal xref">Section 5.3</a>)<a href="#section-5.2-5.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-5.2-6">All these parameters except the AEAD sequence number are constant.
The sequence number provides nonce uniqueness: The nonce used for
each encryption or decryption operation is the result of XORing
<code>base_nonce</code> with the current sequence number, encoded as a big-endian
integer of the same length as <code>base_nonce</code>. Implementations MAY use a
sequence number that is shorter than the nonce length (padding on the left
with zero), but MUST raise an error if the sequence number overflows. The AEAD
algorithm produces ciphertext that is Nt bytes longer than the plaintext.
Nt = 16 for AEAD algorithms defined in this document.<a href="#section-5.2-6" class="pilcrow">¶</a></p>
<p id="section-5.2-7">Encryption is unidirectional from sender to recipient. The sender's
context can encrypt a plaintext <code>pt</code> with associated data <code>aad</code> as
follows:<a href="#section-5.2-7" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.2-8">
<pre>
def ContextS.Seal(aad, pt):
  ct = Seal(self.key, self.ComputeNonce(self.seq), aad, pt)
  self.IncrementSeq()
  return ct
</pre><a href="#section-5.2-8" class="pilcrow">¶</a>
</div>
<p id="section-5.2-9">The recipient's context can decrypt a ciphertext <code>ct</code> with associated
data <code>aad</code> as follows:<a href="#section-5.2-9" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.2-10">
<pre>
def ContextR.Open(aad, ct):
  pt = Open(self.key, self.ComputeNonce(self.seq), aad, ct)
  if pt == OpenError:
    raise OpenError
  self.IncrementSeq()
  return pt
</pre><a href="#section-5.2-10" class="pilcrow">¶</a>
</div>
<p id="section-5.2-11">Each encryption or decryption operation increments the sequence number for
the context in use. The per-message nonce and sequence number increment
details are as follows:<a href="#section-5.2-11" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.2-12">
<pre>
def Context&lt;ROLE&gt;.ComputeNonce(seq):
  seq_bytes = I2OSP(seq, Nn)
  return xor(self.base_nonce, seq_bytes)

def Context&lt;ROLE&gt;.IncrementSeq():
  if self.seq &gt;= (1 &lt;&lt; (8*Nn)) - 1:
    raise MessageLimitReachedError
  self.seq += 1
</pre><a href="#section-5.2-12" class="pilcrow">¶</a>
</div>
<p id="section-5.2-13">The sender's context MUST NOT be used for decryption. Similarly, the recipient's
context MUST NOT be used for encryption. Higher-level protocols reusing the HPKE
key exchange for more general purposes can derive separate keying material as
needed using use the secret export interface; see <a href="#hpke-export" class="auto internal xref">Section 5.3</a> and <a href="#bidirectional" class="auto internal xref">Section 9.8</a>
for more details.<a href="#section-5.2-13" class="pilcrow">¶</a></p>
<p id="section-5.2-14">It is up to the application to ensure that encryptions and decryptions are
done in the proper sequence, so that encryption and decryption nonces align.
If <code>ContextS.Seal()</code> or <code>ContextR.Open()</code> would cause the <code>seq</code> field to
overflow, then the implementation MUST fail with an error. (In the pseudocode
below, <code>Context&lt;ROLE&gt;.IncrementSeq()</code> fails with an error when <code>seq</code> overflows,
which causes <code>ContextS.Seal()</code> and <code>ContextR.Open()</code> to fail accordingly.)
Note that the internal <code>Seal()</code> and <code>Open()</code> calls inside correspond to the
context's AEAD algorithm.<a href="#section-5.2-14" class="pilcrow">¶</a></p>
</section>
</div>
<div id="hpke-export">
<section id="section-5.3">
        <h3 id="name-secret-export">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-secret-export" class="section-name selfRef">Secret Export</a>
        </h3>
<p id="section-5.3-1">HPKE provides an interface for exporting secrets from the encryption context
using a variable-length pseudorandom function (PRF), similar to the TLS 1.3 exporter interface
(see <span>[<a href="#RFC8446" class="cite xref">RFC8446</a>]</span>, Section 7.5). This interface takes as input a context
string <code>exporter_context</code> and a desired length <code>L</code> in bytes, and produces
a secret derived from the internal exporter secret using the corresponding
KDF Expand function. For the KDFs defined in this specification, <code>L</code> has
a maximum value of <code>255*Nh</code>. Future specifications that define new KDFs
MUST specify a bound for <code>L</code>.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<p id="section-5.3-2">The <code>exporter_context</code> field has a maximum length that depends on the KDF
itself, on the definition of <code>LabeledExpand()</code>, and on the constant labels
used together with them. See <a href="#kdf-input-length" class="auto internal xref">Section 7.2.1</a> for precise limits on this
length.<a href="#section-5.3-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.3-3">
<pre>
def Context.Export(exporter_context, L):
  return LabeledExpand(self.exporter_secret, "sec",
                       exporter_context, L)
</pre><a href="#section-5.3-3" class="pilcrow">¶</a>
</div>
<p id="section-5.3-4">Applications that do not use the encryption API in <a href="#hpke-dem" class="auto internal xref">Section 5.2</a> can use
the export-only AEAD ID <code>0xFFFF</code> when computing the key schedule. Such
applications can avoid computing the <code>key</code> and <code>base_nonce</code> values in the
key schedule, as they are not used by the Export interface described above.<a href="#section-5.3-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="single-shot-apis">
<section id="section-6">
      <h2 id="name-single-shot-apis">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-single-shot-apis" class="section-name selfRef">Single-Shot APIs</a>
      </h2>
<div id="single-shot-encryption">
<section id="section-6.1">
        <h3 id="name-encryption-and-decryption-2">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-encryption-and-decryption-2" class="section-name selfRef">Encryption and Decryption</a>
        </h3>
<p id="section-6.1-1">In many cases, applications encrypt only a single message to a recipient's public key.
This section provides templates for HPKE APIs that implement stateless "single-shot"
encryption and decryption using APIs specified in <a href="#hpke-kem" class="auto internal xref">Section 5.1.1</a> and <a href="#hpke-dem" class="auto internal xref">Section 5.2</a>:<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-6.1-2">
<pre>
def Seal&lt;MODE&gt;(pkR, info, aad, pt, ...):
  enc, ctx = Setup&lt;MODE&gt;S(pkR, info, ...)
  ct = ctx.Seal(aad, pt)
  return enc, ct

def Open&lt;MODE&gt;(enc, skR, info, aad, ct, ...):
  ctx = Setup&lt;MODE&gt;R(enc, skR, info, ...)
  return ctx.Open(aad, ct)
</pre><a href="#section-6.1-2" class="pilcrow">¶</a>
</div>
<p id="section-6.1-3">The <code>MODE</code> template parameter is one of Base, PSK, Auth, or AuthPSK. The optional parameters
indicated by "..." depend on <code>MODE</code> and may be empty. For example, <code>SetupBase()</code> has no
additional parameters. <code>SealAuthPSK()</code> and <code>OpenAuthPSK()</code> would be implemented as follows:<a href="#section-6.1-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-6.1-4">
<pre>
def SealAuthPSK(pkR, info, aad, pt, psk, psk_id, skS):
  enc, ctx = SetupAuthPSKS(pkR, info, psk, psk_id, skS)
  ct = ctx.Seal(aad, pt)
  return enc, ct

def OpenAuthPSK(enc, skR, info, aad, ct, psk, psk_id, pkS):
  ctx = SetupAuthPSKR(enc, skR, info, psk, psk_id, pkS)
  return ctx.Open(aad, ct)
</pre><a href="#section-6.1-4" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="secret-export">
<section id="section-6.2">
        <h3 id="name-secret-export-2">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-secret-export-2" class="section-name selfRef">Secret Export</a>
        </h3>
<p id="section-6.2-1">Applications may also want to derive a secret known only to a given recipient.
This section provides templates for HPKE APIs that implement stateless
"single-shot" secret export using APIs specified in <a href="#hpke-export" class="auto internal xref">Section 5.3</a>:<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-6.2-2">
<pre>
def SendExport&lt;MODE&gt;(pkR, info, exporter_context, L, ...):
  enc, ctx = Setup&lt;MODE&gt;S(pkR, info, ...)
  exported = ctx.Export(exporter_context, L)
  return enc, exported

def ReceiveExport&lt;MODE&gt;(enc, skR, info, exporter_context, L, ...):
  ctx = Setup&lt;MODE&gt;R(enc, skR, info, ...)
  return ctx.Export(exporter_context, L)
</pre><a href="#section-6.2-2" class="pilcrow">¶</a>
</div>
<p id="section-6.2-3">As in <a href="#single-shot-encryption" class="auto internal xref">Section 6.1</a>, the <code>MODE</code> template parameter is one of Base, PSK,
Auth, or AuthPSK. The optional parameters indicated by "..." depend on <code>MODE</code> and may
be empty.<a href="#section-6.2-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="ciphersuites">
<section id="section-7">
      <h2 id="name-algorithm-identifiers">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-algorithm-identifiers" class="section-name selfRef">Algorithm Identifiers</a>
      </h2>
<p id="section-7-1">This section lists algorithm identifiers suitable for different HPKE configurations.
Future specifications may introduce new KEM, KDF, and AEAD algorithm identifiers
and retain the security guarantees presented in this document provided they adhere
to the security requirements in <a href="#kem-security" class="auto internal xref">Section 9.2</a>, <a href="#kdf-choice" class="auto internal xref">Section 9.3</a>, and <a href="#aead-security" class="auto internal xref">Section 9.4</a>,
respectively.<a href="#section-7-1" class="pilcrow">¶</a></p>
<div id="kem-ids">
<section id="section-7.1">
        <h3 id="name-key-encapsulation-mechanism">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-key-encapsulation-mechanism" class="section-name selfRef">Key Encapsulation Mechanisms (KEMs)</a>
        </h3>
<span id="name-kem-ids"></span><div id="kemid-values">
<table class="center" id="table-2">
          <caption>
<a href="#table-2" class="selfRef">Table 2</a>:
<a href="#name-kem-ids" class="selfRef">KEM IDs</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Value</th>
              <th class="text-left" rowspan="1" colspan="1">KEM</th>
              <th class="text-left" rowspan="1" colspan="1">Nsecret</th>
              <th class="text-left" rowspan="1" colspan="1">Nenc</th>
              <th class="text-left" rowspan="1" colspan="1">Npk</th>
              <th class="text-left" rowspan="1" colspan="1">Nsk</th>
              <th class="text-left" rowspan="1" colspan="1">Auth</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">0x0000</td>
              <td class="text-left" rowspan="1" colspan="1">Reserved</td>
              <td class="text-left" rowspan="1" colspan="1">N/A</td>
              <td class="text-left" rowspan="1" colspan="1">N/A</td>
              <td class="text-left" rowspan="1" colspan="1">N/A</td>
              <td class="text-left" rowspan="1" colspan="1">N/A</td>
              <td class="text-left" rowspan="1" colspan="1">yes</td>
              <td class="text-left" rowspan="1" colspan="1">RFC 9180</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">0x0010</td>
              <td class="text-left" rowspan="1" colspan="1">DHKEM(P-256, HKDF-SHA256)</td>
              <td class="text-left" rowspan="1" colspan="1">32</td>
              <td class="text-left" rowspan="1" colspan="1">65</td>
              <td class="text-left" rowspan="1" colspan="1">65</td>
              <td class="text-left" rowspan="1" colspan="1">32</td>
              <td class="text-left" rowspan="1" colspan="1">yes</td>
              <td class="text-left" rowspan="1" colspan="1">
                <span>[<a href="#NISTCurves" class="cite xref">NISTCurves</a>]</span>, <span>[<a href="#RFC5869" class="cite xref">RFC5869</a>]</span>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">0x0011</td>
              <td class="text-left" rowspan="1" colspan="1">DHKEM(P-384, HKDF-SHA384)</td>
              <td class="text-left" rowspan="1" colspan="1">48</td>
              <td class="text-left" rowspan="1" colspan="1">97</td>
              <td class="text-left" rowspan="1" colspan="1">97</td>
              <td class="text-left" rowspan="1" colspan="1">48</td>
              <td class="text-left" rowspan="1" colspan="1">yes</td>
              <td class="text-left" rowspan="1" colspan="1">
                <span>[<a href="#NISTCurves" class="cite xref">NISTCurves</a>]</span>, <span>[<a href="#RFC5869" class="cite xref">RFC5869</a>]</span>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">0x0012</td>
              <td class="text-left" rowspan="1" colspan="1">DHKEM(P-521, HKDF-SHA512)</td>
              <td class="text-left" rowspan="1" colspan="1">64</td>
              <td class="text-left" rowspan="1" colspan="1">133</td>
              <td class="text-left" rowspan="1" colspan="1">133</td>
              <td class="text-left" rowspan="1" colspan="1">66</td>
              <td class="text-left" rowspan="1" colspan="1">yes</td>
              <td class="text-left" rowspan="1" colspan="1">
                <span>[<a href="#NISTCurves" class="cite xref">NISTCurves</a>]</span>, <span>[<a href="#RFC5869" class="cite xref">RFC5869</a>]</span>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">0x0020</td>
              <td class="text-left" rowspan="1" colspan="1">DHKEM(X25519, HKDF-SHA256)</td>
              <td class="text-left" rowspan="1" colspan="1">32</td>
              <td class="text-left" rowspan="1" colspan="1">32</td>
              <td class="text-left" rowspan="1" colspan="1">32</td>
              <td class="text-left" rowspan="1" colspan="1">32</td>
              <td class="text-left" rowspan="1" colspan="1">yes</td>
              <td class="text-left" rowspan="1" colspan="1">
                <span>[<a href="#RFC7748" class="cite xref">RFC7748</a>]</span>, <span>[<a href="#RFC5869" class="cite xref">RFC5869</a>]</span>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">0x0021</td>
              <td class="text-left" rowspan="1" colspan="1">DHKEM(X448, HKDF-SHA512)</td>
              <td class="text-left" rowspan="1" colspan="1">64</td>
              <td class="text-left" rowspan="1" colspan="1">56</td>
              <td class="text-left" rowspan="1" colspan="1">56</td>
              <td class="text-left" rowspan="1" colspan="1">56</td>
              <td class="text-left" rowspan="1" colspan="1">yes</td>
              <td class="text-left" rowspan="1" colspan="1">
                <span>[<a href="#RFC7748" class="cite xref">RFC7748</a>]</span>, <span>[<a href="#RFC5869" class="cite xref">RFC5869</a>]</span>
</td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-7.1-2">The <code>Auth</code> column indicates if the KEM algorithm provides the <code>AuthEncap()</code>/<code>AuthDecap()</code>
interface and is therefore suitable for the Auth and AuthPSK modes. The meaning of all
other columns is explained in <a href="#kem-template" class="auto internal xref">Section 11.1</a>. All algorithms are suitable for the
PSK mode.<a href="#section-7.1-2" class="pilcrow">¶</a></p>
<div id="serializepublickey-and-deserializepublickey">
<section id="section-7.1.1">
          <h4 id="name-serializepublickey-and-dese">
<a href="#section-7.1.1" class="section-number selfRef">7.1.1. </a><a href="#name-serializepublickey-and-dese" class="section-name selfRef">SerializePublicKey and DeserializePublicKey</a>
          </h4>
<p id="section-7.1.1-1">For P-256, P-384, and P-521, the <code>SerializePublicKey()</code> function of the
KEM performs the uncompressed Elliptic-Curve-Point-to-Octet-String
conversion according to <span>[<a href="#SECG" class="cite xref">SECG</a>]</span>. <code>DeserializePublicKey()</code> performs the
uncompressed Octet-String-to-Elliptic-Curve-Point conversion.<a href="#section-7.1.1-1" class="pilcrow">¶</a></p>
<p id="section-7.1.1-2">For X25519 and X448, the <code>SerializePublicKey()</code> and <code>DeserializePublicKey()</code>
functions are the identity function, since these curves already use
fixed-length byte strings for public keys.<a href="#section-7.1.1-2" class="pilcrow">¶</a></p>
<p id="section-7.1.1-3">Some deserialized public keys MUST be validated before they can be used. See
<a href="#validation" class="auto internal xref">Section 7.1.4</a> for specifics.<a href="#section-7.1.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="serializeprivatekey">
<section id="section-7.1.2">
          <h4 id="name-serializeprivatekey-and-des">
<a href="#section-7.1.2" class="section-number selfRef">7.1.2. </a><a href="#name-serializeprivatekey-and-des" class="section-name selfRef">SerializePrivateKey and DeserializePrivateKey</a>
          </h4>
<p id="section-7.1.2-1">As per <span>[<a href="#SECG" class="cite xref">SECG</a>]</span>, P-256, P-384, and P-521 private keys are field elements in the
scalar field of the curve being used. For this section, and for
<a href="#derive-key-pair" class="auto internal xref">Section 7.1.3</a>, it is assumed that implementors of ECDH over these curves
use an integer representation of private keys that is compatible with the
<code>OS2IP()</code> function.<a href="#section-7.1.2-1" class="pilcrow">¶</a></p>
<p id="section-7.1.2-2">For P-256, P-384, and P-521, the <code>SerializePrivateKey()</code> function of the KEM
performs the Field-Element-to-Octet-String conversion according to <span>[<a href="#SECG" class="cite xref">SECG</a>]</span>. If
the private key is an integer outside the range <code>[0, order-1]</code>, where <code>order</code>
is the order of the curve being used, the private key MUST be reduced to its
representative in <code>[0, order-1]</code> before being serialized.
<code>DeserializePrivateKey()</code> performs the Octet-String-to-Field-Element conversion
according to <span>[<a href="#SECG" class="cite xref">SECG</a>]</span>.<a href="#section-7.1.2-2" class="pilcrow">¶</a></p>
<p id="section-7.1.2-3">For X25519 and X448, private keys are identical to their byte string
representation, so little processing has to be done. The
<code>SerializePrivateKey()</code> function MUST clamp its output and the
<code>DeserializePrivateKey()</code> function MUST clamp its input, where <em>clamping</em> refers to the
bitwise operations performed on <code>k</code> in the <code>decodeScalar25519()</code> and
<code>decodeScalar448()</code> functions defined in Section 5 of <span>[<a href="#RFC7748" class="cite xref">RFC7748</a>]</span>.<a href="#section-7.1.2-3" class="pilcrow">¶</a></p>
<p id="section-7.1.2-4">To catch invalid keys early on, implementors of DHKEMs SHOULD check that
deserialized private keys are not equivalent to 0 (mod <code>order</code>), where <code>order</code>
is the order of the DH group. Note that this property is trivially true for X25519
and X448 groups, since clamped values can never be 0 (mod <code>order</code>).<a href="#section-7.1.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="derive-key-pair">
<section id="section-7.1.3">
          <h4 id="name-derivekeypair">
<a href="#section-7.1.3" class="section-number selfRef">7.1.3. </a><a href="#name-derivekeypair" class="section-name selfRef">DeriveKeyPair</a>
          </h4>
<p id="section-7.1.3-1">The keys that <code>DeriveKeyPair()</code> produces have only as much entropy as the provided
input keying material. For a given KEM, the <code>ikm</code> parameter given to <code>DeriveKeyPair()</code> SHOULD
have length at least <code>Nsk</code>, and SHOULD have at least <code>Nsk</code> bytes of entropy.<a href="#section-7.1.3-1" class="pilcrow">¶</a></p>
<p id="section-7.1.3-2">All invocations of KDF functions (such as <code>LabeledExtract</code> or <code>LabeledExpand</code>) in any
DHKEM's <code>DeriveKeyPair()</code> function use the DHKEM's associated KDF (as opposed to
the ciphersuite's KDF).<a href="#section-7.1.3-2" class="pilcrow">¶</a></p>
<p id="section-7.1.3-3">For P-256, P-384, and P-521, the <code>DeriveKeyPair()</code> function of the KEM performs
rejection sampling over field elements:<a href="#section-7.1.3-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.1.3-4">
<pre>
def DeriveKeyPair(ikm):
  dkp_prk = LabeledExtract("", "dkp_prk", ikm)
  sk = 0
  counter = 0
  while sk == 0 or sk &gt;= order:
    if counter &gt; 255:
      raise DeriveKeyPairError
    bytes = LabeledExpand(dkp_prk, "candidate",
                          I2OSP(counter, 1), Nsk)
    bytes[0] = bytes[0] &amp; bitmask
    sk = OS2IP(bytes)
    counter = counter + 1
  return (sk, pk(sk))
</pre><a href="#section-7.1.3-4" class="pilcrow">¶</a>
</div>
<p id="section-7.1.3-5"><code>order</code> is the order of the curve being used (see Section D.1.2 of <span>[<a href="#NISTCurves" class="cite xref">NISTCurves</a>]</span>), and
is listed below for completeness.<a href="#section-7.1.3-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.1.3-6">
<pre>
P-256:
0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551

P-384:
0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf
  581a0db248b0a77aecec196accc52973

P-521:
0x01ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
  fa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409
</pre><a href="#section-7.1.3-6" class="pilcrow">¶</a>
</div>
<p id="section-7.1.3-7"><code>bitmask</code> is defined to be 0xFF for P-256 and P-384, and 0x01 for P-521.
The precise likelihood of <code>DeriveKeyPair()</code> failing with DeriveKeyPairError
depends on the group being used, but it is negligibly small in all cases.
See <a href="#api-errors" class="auto internal xref">Section 8.2</a> for information about dealing with such failures.<a href="#section-7.1.3-7" class="pilcrow">¶</a></p>
<p id="section-7.1.3-8">For X25519 and X448, the <code>DeriveKeyPair()</code> function applies a KDF to the input:<a href="#section-7.1.3-8" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.1.3-9">
<pre>
def DeriveKeyPair(ikm):
  dkp_prk = LabeledExtract("", "dkp_prk", ikm)
  sk = LabeledExpand(dkp_prk, "sk", "", Nsk)
  return (sk, pk(sk))
</pre><a href="#section-7.1.3-9" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="validation">
<section id="section-7.1.4">
          <h4 id="name-validation-of-inputs-and-ou">
<a href="#section-7.1.4" class="section-number selfRef">7.1.4. </a><a href="#name-validation-of-inputs-and-ou" class="section-name selfRef">Validation of Inputs and Outputs</a>
          </h4>
<p id="section-7.1.4-1">The following public keys are subject to validation if the group
requires public key validation: the sender MUST validate the recipient's
public key <code>pkR</code>; the recipient MUST validate the ephemeral public key
<code>pkE</code>; in authenticated modes, the recipient MUST validate the sender's
static public key <code>pkS</code>. Validation failure yields a <code>ValidationError</code>.<a href="#section-7.1.4-1" class="pilcrow">¶</a></p>
<p id="section-7.1.4-2">For P-256, P-384 and P-521, senders and recipients MUST perform partial
public key validation on all public key inputs, as defined in Section 5.6.2.3.4
of <span>[<a href="#keyagreement" class="cite xref">keyagreement</a>]</span>. This includes checking that the coordinates are in the
correct range, that the point is on the curve, and that the point is not the
point at infinity. Additionally, senders and recipients MUST ensure the
Diffie-Hellman shared secret is not the point at infinity.<a href="#section-7.1.4-2" class="pilcrow">¶</a></p>
<p id="section-7.1.4-3">For X25519 and X448, public keys and Diffie-Hellman outputs MUST be validated
as described in <span>[<a href="#RFC7748" class="cite xref">RFC7748</a>]</span>. In particular, recipients MUST check whether
the Diffie-Hellman shared secret is the all-zero value and abort if so.<a href="#section-7.1.4-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="future-kems">
<section id="section-7.1.5">
          <h4 id="name-future-kems">
<a href="#section-7.1.5" class="section-number selfRef">7.1.5. </a><a href="#name-future-kems" class="section-name selfRef">Future KEMs</a>
          </h4>
<p id="section-7.1.5-1"><a href="#kem-security" class="auto internal xref">Section 9.2</a> lists security requirements on a KEM used within HPKE.<a href="#section-7.1.5-1" class="pilcrow">¶</a></p>
<p id="section-7.1.5-2">The <code>AuthEncap()</code> and <code>AuthDecap()</code> functions are OPTIONAL. If a KEM algorithm
does not provide them, only the Base and PSK modes of HPKE are supported.
Future specifications that define new KEMs MUST indicate whether or not
Auth and AuthPSK modes are supported.<a href="#section-7.1.5-2" class="pilcrow">¶</a></p>
<p id="section-7.1.5-3">A KEM algorithm may support different encoding algorithms, with different output
lengths, for KEM public keys. Such KEM algorithms MUST specify only one encoding
algorithm whose output length is <code>Npk</code>.<a href="#section-7.1.5-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="kdf-ids">
<section id="section-7.2">
        <h3 id="name-key-derivation-functions-kd">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-key-derivation-functions-kd" class="section-name selfRef">Key Derivation Functions (KDFs)</a>
        </h3>
<span id="name-kdf-ids"></span><div id="kdfid-values">
<table class="center" id="table-3">
          <caption>
<a href="#table-3" class="selfRef">Table 3</a>:
<a href="#name-kdf-ids" class="selfRef">KDF IDs</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Value</th>
              <th class="text-left" rowspan="1" colspan="1">KDF</th>
              <th class="text-left" rowspan="1" colspan="1">Nh</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">0x0000</td>
              <td class="text-left" rowspan="1" colspan="1">Reserved</td>
              <td class="text-left" rowspan="1" colspan="1">N/A</td>
              <td class="text-left" rowspan="1" colspan="1">RFC 9180</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">0x0001</td>
              <td class="text-left" rowspan="1" colspan="1">HKDF-SHA256</td>
              <td class="text-left" rowspan="1" colspan="1">32</td>
              <td class="text-left" rowspan="1" colspan="1">
                <span>[<a href="#RFC5869" class="cite xref">RFC5869</a>]</span>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">0x0002</td>
              <td class="text-left" rowspan="1" colspan="1">HKDF-SHA384</td>
              <td class="text-left" rowspan="1" colspan="1">48</td>
              <td class="text-left" rowspan="1" colspan="1">
                <span>[<a href="#RFC5869" class="cite xref">RFC5869</a>]</span>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">0x0003</td>
              <td class="text-left" rowspan="1" colspan="1">HKDF-SHA512</td>
              <td class="text-left" rowspan="1" colspan="1">64</td>
              <td class="text-left" rowspan="1" colspan="1">
                <span>[<a href="#RFC5869" class="cite xref">RFC5869</a>]</span>
</td>
            </tr>
          </tbody>
        </table>
</div>
<div id="kdf-input-length">
<section id="section-7.2.1">
          <h4 id="name-input-length-restrictions">
<a href="#section-7.2.1" class="section-number selfRef">7.2.1. </a><a href="#name-input-length-restrictions" class="section-name selfRef">Input Length Restrictions</a>
          </h4>
<p id="section-7.2.1-1">This document defines <code>LabeledExtract()</code> and <code>LabeledExpand()</code> based on the
KDFs listed above. These functions add prefixes to their respective
inputs <code>ikm</code> and <code>info</code> before calling the KDF's <code>Extract()</code> and <code>Expand()</code>
functions. This leads to a reduction of the maximum input length that
is available for the inputs <code>psk</code>, <code>psk_id</code>, <code>info</code>, <code>exporter_context</code>,
<code>ikm</code>, i.e., the variable-length parameters provided by HPKE applications.
The following table lists the maximum allowed lengths of these fields
for the KDFs defined in this document, as inclusive bounds in bytes:<a href="#section-7.2.1-1" class="pilcrow">¶</a></p>
<span id="name-application-input-limits"></span><div id="input-limits">
<table class="center" id="table-4">
            <caption>
<a href="#table-4" class="selfRef">Table 4</a>:
<a href="#name-application-input-limits" class="selfRef">Application Input Limits</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Input</th>
                <th class="text-left" rowspan="1" colspan="1">HKDF-SHA256</th>
                <th class="text-left" rowspan="1" colspan="1">HKDF-SHA384</th>
                <th class="text-left" rowspan="1" colspan="1">HKDF-SHA512</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">psk</td>
                <td class="text-left" rowspan="1" colspan="1">2^{61} - 88</td>
                <td class="text-left" rowspan="1" colspan="1">2^{125} - 152</td>
                <td class="text-left" rowspan="1" colspan="1">2^{125} - 152</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">psk_id</td>
                <td class="text-left" rowspan="1" colspan="1">2^{61} - 93</td>
                <td class="text-left" rowspan="1" colspan="1">2^{125} - 157</td>
                <td class="text-left" rowspan="1" colspan="1">2^{125} - 157</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">info</td>
                <td class="text-left" rowspan="1" colspan="1">2^{61} - 91</td>
                <td class="text-left" rowspan="1" colspan="1">2^{125} - 155</td>
                <td class="text-left" rowspan="1" colspan="1">2^{125} - 155</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">exporter_context</td>
                <td class="text-left" rowspan="1" colspan="1">2^{61} - 120</td>
                <td class="text-left" rowspan="1" colspan="1">2^{125} - 200</td>
                <td class="text-left" rowspan="1" colspan="1">2^{125} - 216</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">ikm (DeriveKeyPair)</td>
                <td class="text-left" rowspan="1" colspan="1">2^{61} - 84</td>
                <td class="text-left" rowspan="1" colspan="1">2^{125} - 148</td>
                <td class="text-left" rowspan="1" colspan="1">2^{125} - 148</td>
              </tr>
            </tbody>
          </table>
</div>
<p id="section-7.2.1-3">This shows that the limits are only marginally smaller than the maximum
input length of the underlying hash function; these limits are large and
unlikely to be reached in practical applications. Future specifications
that define new KDFs MUST specify bounds for these variable-length
parameters.<a href="#section-7.2.1-3" class="pilcrow">¶</a></p>
<p id="section-7.2.1-4">Since the above bounds are larger than any values used in practice, it may be
useful for implementations to impose a lower limit on the values they will
accept (for example, to avoid dynamic allocations).  Implementations SHOULD set
such a limit to be no less than maximum <code>Nsk</code> size for a KEM supported by the
implementation.  For an implementation that supports all of the KEMs in this
document, the limit would be 66 bytes, which is hte <code>Nsk</code> value for DHKEM(P-521,
HKDF-SHA512).<a href="#section-7.2.1-4" class="pilcrow">¶</a></p>
<p id="section-7.2.1-5">The values for <code>psk</code>, <code>psk_id</code>, <code>info</code>, and <code>ikm</code>, which are inputs to
<code>LabeledExtract()</code>, were computed with the following expression:<a href="#section-7.2.1-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.2.1-6">
<pre>
max_size_hash_input - Nb - size_version_label -
    size_suite_id - size_input_label
</pre><a href="#section-7.2.1-6" class="pilcrow">¶</a>
</div>
<p id="section-7.2.1-7">The value for <code>exporter_context</code>, which is an input to <code>LabeledExpand()</code>,
was computed with the following expression:<a href="#section-7.2.1-7" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.2.1-8">
<pre>
max_size_hash_input - Nb - Nh - size_version_label -
    size_suite_id - size_input_label - 2 - 1
</pre><a href="#section-7.2.1-8" class="pilcrow">¶</a>
</div>
<p id="section-7.2.1-9">In these equations, <code>max_size_hash_input</code> is the maximum input length
of the underlying hash function in bytes, <code>Nb</code> is the block size of the
underlying hash function in bytes, <code>size_version_label</code> is the size
of "HPKE-v1" in bytes and equals 7, <code>size_suite_id</code> is the size of the
<code>suite_id</code> in bytes and equals 5 for DHKEM (relevant for <code>ikm</code>) and 10 for the
remainder of HPKE (relevant for <code>psk</code>, <code>psk_id</code>, <code>info</code>, and <code>exporter_context</code>),
and <code>size_input_label</code> is the size in bytes of the label used as parameter to
<code>LabeledExtract()</code> or <code>LabeledExpand()</code>, the maximum of which is 13
across all labels in this document.<a href="#section-7.2.1-9" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="aead-ids">
<section id="section-7.3">
        <h3 id="name-authenticated-encryption-wi">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-authenticated-encryption-wi" class="section-name selfRef">Authenticated Encryption with Associated Data (AEAD) Functions</a>
        </h3>
<span id="name-aead-ids"></span><div id="aeadid-values">
<table class="center" id="table-5">
          <caption>
<a href="#table-5" class="selfRef">Table 5</a>:
<a href="#name-aead-ids" class="selfRef">AEAD IDs</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Value</th>
              <th class="text-left" rowspan="1" colspan="1">AEAD</th>
              <th class="text-left" rowspan="1" colspan="1">Nk</th>
              <th class="text-left" rowspan="1" colspan="1">Nn</th>
              <th class="text-left" rowspan="1" colspan="1">Nt</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">0x0000</td>
              <td class="text-left" rowspan="1" colspan="1">Reserved</td>
              <td class="text-left" rowspan="1" colspan="1">N/A</td>
              <td class="text-left" rowspan="1" colspan="1">N/A</td>
              <td class="text-left" rowspan="1" colspan="1">N/A</td>
              <td class="text-left" rowspan="1" colspan="1">RFC 9180</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">0x0001</td>
              <td class="text-left" rowspan="1" colspan="1">AES-128-GCM</td>
              <td class="text-left" rowspan="1" colspan="1">16</td>
              <td class="text-left" rowspan="1" colspan="1">12</td>
              <td class="text-left" rowspan="1" colspan="1">16</td>
              <td class="text-left" rowspan="1" colspan="1">
                <span>[<a href="#GCM" class="cite xref">GCM</a>]</span>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">0x0002</td>
              <td class="text-left" rowspan="1" colspan="1">AES-256-GCM</td>
              <td class="text-left" rowspan="1" colspan="1">32</td>
              <td class="text-left" rowspan="1" colspan="1">12</td>
              <td class="text-left" rowspan="1" colspan="1">16</td>
              <td class="text-left" rowspan="1" colspan="1">
                <span>[<a href="#GCM" class="cite xref">GCM</a>]</span>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">0x0003</td>
              <td class="text-left" rowspan="1" colspan="1">ChaCha20Poly1305</td>
              <td class="text-left" rowspan="1" colspan="1">32</td>
              <td class="text-left" rowspan="1" colspan="1">12</td>
              <td class="text-left" rowspan="1" colspan="1">16</td>
              <td class="text-left" rowspan="1" colspan="1">
                <span>[<a href="#RFC8439" class="cite xref">RFC8439</a>]</span>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">0xFFFF</td>
              <td class="text-left" rowspan="1" colspan="1">Export-only</td>
              <td class="text-left" rowspan="1" colspan="1">N/A</td>
              <td class="text-left" rowspan="1" colspan="1">N/A</td>
              <td class="text-left" rowspan="1" colspan="1">N/A</td>
              <td class="text-left" rowspan="1" colspan="1">RFC 9180</td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-7.3-2">The <code>0xFFFF</code> AEAD ID is reserved for applications that only use the Export
interface; see <a href="#hpke-export" class="auto internal xref">Section 5.3</a> for more details.<a href="#section-7.3-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="api-considerations">
<section id="section-8">
      <h2 id="name-api-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-api-considerations" class="section-name selfRef">API Considerations</a>
      </h2>
<p id="section-8-1">This section documents considerations for interfaces to implementations of HPKE.
This includes error handling considerations and recommendations that improve
interoperability when HPKE is used in applications.<a href="#section-8-1" class="pilcrow">¶</a></p>
<div id="auxiliary-authenticated-application-information">
<section id="section-8.1">
        <h3 id="name-auxiliary-authenticated-app">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-auxiliary-authenticated-app" class="section-name selfRef">Auxiliary Authenticated Application Information</a>
        </h3>
<p id="section-8.1-1">HPKE has two places at which applications can specify auxiliary authenticated information:
(1) during context construction via the Setup <code>info</code> parameter, and (2) during Context
operations, i.e., with the <code>aad</code> parameter for <code>Open()</code> and <code>Seal()</code>, and the <code>exporter_context</code> parameter
for <code>Export()</code>. Application information applicable to multiple operations on a single Context
should use the Setup <code>info</code> parameter. This avoids redundantly processing this information for
each Context operation. In contrast, application information that varies on a per-message basis
should be specified via the Context APIs (<code>Seal()</code>, <code>Open()</code>, or <code>Export()</code>).<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<p id="section-8.1-2">Applications that only use the single-shot APIs described in <a href="#single-shot-apis" class="auto internal xref">Section 6</a> should use the
Setup <code>info</code> parameter for specifying auxiliary authenticated information. Implementations which
only expose single-shot APIs should not allow applications to use both Setup <code>info</code> and Context
<code>aad</code> or <code>exporter_context</code> auxiliary information parameters.<a href="#section-8.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="api-errors">
<section id="section-8.2">
        <h3 id="name-errors">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-errors" class="section-name selfRef">Errors</a>
        </h3>
<p id="section-8.2-1">The high-level, public HPKE APIs specified in this document are all fallible.
These include the Setup functions and all encryption context functions.
For example, <code>Decap()</code> can fail if the encapsulated key <code>enc</code> is invalid,
and <code>Open()</code> may fail if ciphertext decryption fails. The explicit errors
generated throughout this specification, along with the conditions that
lead to each error, are as follows:<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.2-2.1">
            <p id="section-8.2-2.1.1"><code>ValidationError</code>: KEM input or output validation failure; <a href="#dhkem" class="auto internal xref">Section 4.1</a>.<a href="#section-8.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.2-2.2">
            <p id="section-8.2-2.2.1"><code>DeserializeError</code>: Public or private key deserialization failure; <a href="#base-crypto" class="auto internal xref">Section 4</a>.<a href="#section-8.2-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.2-2.3">
            <p id="section-8.2-2.3.1"><code>EncapError</code>: <code>Encap()</code> failure; <a href="#base-crypto" class="auto internal xref">Section 4</a>.<a href="#section-8.2-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.2-2.4">
            <p id="section-8.2-2.4.1"><code>DecapError</code>: <code>Decap()</code> failure; <a href="#base-crypto" class="auto internal xref">Section 4</a>.<a href="#section-8.2-2.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.2-2.5">
            <p id="section-8.2-2.5.1"><code>OpenError</code>: Context AEAD <code>Open()</code> failure; <a href="#base-crypto" class="auto internal xref">Section 4</a> and <a href="#hpke-dem" class="auto internal xref">Section 5.2</a>.<a href="#section-8.2-2.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.2-2.6">
            <p id="section-8.2-2.6.1"><code>MessageLimitReachedError</code>: Context AEAD sequence number overflow; <a href="#base-crypto" class="auto internal xref">Section 4</a> and <a href="#hpke-dem" class="auto internal xref">Section 5.2</a>.<a href="#section-8.2-2.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.2-2.7">
            <p id="section-8.2-2.7.1"><code>DeriveKeyPairError</code>: Key pair derivation failure; <a href="#derive-key-pair" class="auto internal xref">Section 7.1.3</a>.<a href="#section-8.2-2.7.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-8.2-3">Implicit errors may also occur. As an example, certain classes of failures,
e.g., malformed recipient public keys, may not yield explicit errors.
For example, for the DHKEM variant described in this specification,
the <code>Encap()</code> algorithm fails when given an invalid recipient public key.
However, other KEM algorithms may not have an efficient algorithm for verifying
the validity of public keys. As a result, an equivalent error may not manifest
until AEAD decryption at the recipient. As another example, DHKEM's <code>AuthDecap()</code>
function will produce invalid output if given the wrong sender public key.
This error is not detectable until subsequent AEAD decryption.<a href="#section-8.2-3" class="pilcrow">¶</a></p>
<p id="section-8.2-4">The errors in this document are meant as a guide for implementors. They are not
an exhaustive list of all the errors an implementation might emit. For example,
future KEMs might have internal failure cases, or an implementation might run
out of memory.<a href="#section-8.2-4" class="pilcrow">¶</a></p>
<p id="section-8.2-5">How these errors are expressed in an API or handled by applications is an
implementation-specific detail. For example, some implementations may abort or
panic upon a <code>DeriveKeyPairError</code> failure given that it only occurs with
negligible probability, whereas other implementations may retry the failed
DeriveKeyPair operation. See <a href="#derive-key-pair" class="auto internal xref">Section 7.1.3</a> for more information.
As another example, some implementations of the DHKEM specified in this document
may choose to transform <code>ValidationError</code> from <code>DH()</code> into an <code>EncapError</code> or
<code>DecapError</code> from <code>Encap()</code> or <code>Decap()</code>, respectively, whereas others may choose
to raise <code>ValidationError</code> unmodified.<a href="#section-8.2-5" class="pilcrow">¶</a></p>
<p id="section-8.2-6">Applications using HPKE APIs should not assume that the errors here are complete,
nor should they assume certain classes of errors will always manifest the same way
for all ciphersuites. For example, the DHKEM specified in this document will emit
a <code>DeserializationError</code> or <code>ValidationError</code> if a KEM public key is invalid. However,
a new KEM might not have an efficient algorithm for determining whether or not a
public key is valid. In this case, an invalid public key might instead yield an
<code>OpenError</code> when trying to decrypt a ciphertext.<a href="#section-8.2-6" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-considerations">
<section id="section-9">
      <h2 id="name-security-considerations">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<div id="sec-properties">
<section id="section-9.1">
        <h3 id="name-security-properties">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-security-properties" class="section-name selfRef">Security Properties</a>
        </h3>
<p id="section-9.1-1">HPKE has several security goals, depending on the mode of operation,
against active and adaptive attackers that can compromise partial
secrets of senders and recipients. The desired security goals are
detailed below:<a href="#section-9.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.1-2.1">
            <p id="section-9.1-2.1.1">Message secrecy: Confidentiality of the sender's messages against
chosen ciphertext attacks<a href="#section-9.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.1-2.2">
            <p id="section-9.1-2.2.1">Export key secrecy: Indistinguishability of each export
secret from a uniformly random bitstring of equal length, i.e.,
<code>Context.Export</code> is a variable-length PRF<a href="#section-9.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.1-2.3">
            <p id="section-9.1-2.3.1">Sender authentication: Proof of sender origin for PSK, Auth, and
AuthPSK modes<a href="#section-9.1-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-9.1-3">These security goals are expected to hold for any honest sender and
honest recipient keys, as well as if the honest sender and honest
recipient keys are the same.<a href="#section-9.1-3" class="pilcrow">¶</a></p>
<p id="section-9.1-4">HPKE mitigates malleability problems (called benign malleability <span>[<a href="#SECG" class="cite xref">SECG</a>]</span>) in prior
public key encryption standards based on ECIES by including all public keys in the
context of the key schedule.<a href="#section-9.1-4" class="pilcrow">¶</a></p>
<p id="section-9.1-5">HPKE does not provide forward secrecy with respect to recipient compromise.
In the Base and Auth modes, the secrecy properties are only expected to
hold if the recipient private key <code>skR</code> is not compromised at any point
in time. In the PSK and AuthPSK modes, the secrecy properties are
expected to hold if the recipient private key <code>skR</code> and the pre-shared key
are not both compromised at any point in time. See <a href="#non-goals" class="auto internal xref">Section 9.7</a> for more
details.<a href="#section-9.1-5" class="pilcrow">¶</a></p>
<p id="section-9.1-6">In the Auth mode, sender authentication is generally expected to hold if
the sender private key <code>skS</code> is not compromised at the time of message
reception. In the AuthPSK mode, sender authentication is generally
expected to hold if, at the time of message reception, the sender private
key skS and the pre-shared key are not both compromised.<a href="#section-9.1-6" class="pilcrow">¶</a></p>
<p id="section-9.1-7">Besides forward secrecy and key-compromise impersonation, which are highlighted
in this section because of their particular cryptographic importance, HPKE
has other non-goals that are described in <a href="#non-goals" class="auto internal xref">Section 9.7</a>: no tolerance of
message reordering or loss, no downgrade or replay prevention, no hiding of the
plaintext length, and no protection against bad ephemeral randomness. <a href="#non-goals" class="auto internal xref">Section 9.7</a>
suggests application-level mitigations for some of them.<a href="#section-9.1-7" class="pilcrow">¶</a></p>
<div id="kci">
<section id="section-9.1.1">
          <h4 id="name-key-compromise-impersonatio">
<a href="#section-9.1.1" class="section-number selfRef">9.1.1. </a><a href="#name-key-compromise-impersonatio" class="section-name selfRef">Key-Compromise Impersonation</a>
          </h4>
<p id="section-9.1.1-1">The DHKEM variants defined in this document are
vulnerable to key-compromise impersonation attacks <span>[<a href="#BJM97" class="cite xref">BJM97</a>]</span>,
which means that sender authentication cannot be expected to hold in the
Auth mode if the recipient private key <code>skR</code> is compromised, and in the
AuthPSK mode if the pre-shared key and the recipient private key <code>skR</code> are
both compromised. NaCl's <code>box</code> interface <span>[<a href="#NaCl" class="cite xref">NaCl</a>]</span> has the same issue. At
the same time, this enables repudiability.<a href="#section-9.1.1-1" class="pilcrow">¶</a></p>
<p id="section-9.1.1-2">As shown by <span>[<a href="#ABHKLR20" class="cite xref">ABHKLR20</a>]</span>, key-compromise impersonation attacks are generally possible on HPKE
because KEM ciphertexts are not bound to HPKE messages. An adversary who
knows a recipient's private key can decapsulate an observed KEM ciphertext,
compute the key schedule, and encrypt an arbitrary message that the recipient
will accept as coming from the original sender. Importantly, this is possible even
with a KEM that is resistant to key-compromise impersonation attacks. As a
result, mitigating this issue requires fundamental changes that are out of scope
of this specification.<a href="#section-9.1.1-2" class="pilcrow">¶</a></p>
<p id="section-9.1.1-3">Applications that require resistance against key-compromise impersonation
SHOULD take extra steps to prevent this attack. One possibility is to
produce a digital signature over <code>(enc, ct)</code> tuples using a sender's
private key -- where <code>ct</code> is an AEAD ciphertext produced by the single-shot
or multi-shot API and <code>enc</code> is the corresponding KEM encapsulated key.<a href="#section-9.1.1-3" class="pilcrow">¶</a></p>
<p id="section-9.1.1-4">Given these properties, pre-shared keys strengthen both the authentication and the
secrecy properties in certain adversary models. One particular example in which
this can be useful is a hybrid quantum setting: if a
non-quantum-resistant KEM used with HPKE is broken by a
quantum computer, the security properties are preserved through the use
of a pre-shared key. As described in Section 7 of <span>[<a href="#RFC8696" class="cite xref">RFC8696</a>]</span> this
assumes that the pre-shared key has not been compromised.<a href="#section-9.1.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="computational-analysis">
<section id="section-9.1.2">
          <h4 id="name-computational-analysis">
<a href="#section-9.1.2" class="section-number selfRef">9.1.2. </a><a href="#name-computational-analysis" class="section-name selfRef">Computational Analysis</a>
          </h4>
<p id="section-9.1.2-1">It is shown in <span>[<a href="#CS01" class="cite xref">CS01</a>]</span> that a hybrid public key encryption scheme of
essentially the same form as the Base mode described here is
IND-CCA2-secure as long as the underlying KEM and AEAD schemes are
IND-CCA2-secure. Moreover, it is shown in <span>[<a href="#HHK06" class="cite xref">HHK06</a>]</span> that IND-CCA2 security
of the KEM and the data encapsulation mechanism are necessary conditions
to achieve IND-CCA2 security for hybrid public key encryption.
The main difference between the scheme proposed in <span>[<a href="#CS01" class="cite xref">CS01</a>]</span>
and the Base mode in this document (both named HPKE) is that we interpose
some KDF calls between the KEM and the AEAD. Analyzing the HPKE Base mode
instantiation in this document therefore requires verifying that the
additional KDF calls do not cause the IND-CCA2 property to fail, as
well as verifying the additional export key secrecy property.<a href="#section-9.1.2-1" class="pilcrow">¶</a></p>
<p id="section-9.1.2-2">Analysis of the PSK, Auth, and AuthPSK modes defined in this document
additionally requires verifying the sender authentication property.
While the PSK mode just adds supplementary keying material to the key
schedule, the Auth and AuthPSK modes make use of a non-standard
authenticated KEM construction. Generally, the authenticated modes of
HPKE can be viewed and analyzed as flavors of signcryption <span>[<a href="#SigncryptionDZ10" class="cite xref">SigncryptionDZ10</a>]</span>.<a href="#section-9.1.2-2" class="pilcrow">¶</a></p>
<p id="section-9.1.2-3">A preliminary computational analysis of all HPKE modes has been done
in <span>[<a href="#HPKEAnalysis" class="cite xref">HPKEAnalysis</a>]</span>, indicating asymptotic security for the case where
the KEM is DHKEM, the AEAD is any IND-CPA-secure and INT-CTXT-secure scheme,
and the DH group and KDF satisfy the following conditions:<a href="#section-9.1.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.1.2-4.1">
              <p id="section-9.1.2-4.1.1">DH group: The gap Diffie-Hellman (GDH) problem is hard in the
appropriate subgroup <span>[<a href="#GAP" class="cite xref">GAP</a>]</span>.<a href="#section-9.1.2-4.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-9.1.2-4.2">
              <p id="section-9.1.2-4.2.1"><code>Extract()</code> and <code>Expand()</code>: <code>Extract()</code> can be modeled as a random oracle.
<code>Expand()</code> can be modeled as a pseudorandom function, wherein the first
argument is the key.<a href="#section-9.1.2-4.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-9.1.2-5">In particular, the KDFs and DH groups defined in this document (see
<a href="#kdf-ids" class="auto internal xref">Section 7.2</a> and <a href="#kem-ids" class="auto internal xref">Section 7.1</a>) satisfy these properties when used as
specified. The analysis in <span>[<a href="#HPKEAnalysis" class="cite xref">HPKEAnalysis</a>]</span> demonstrates that under these
constraints, HPKE continues to provide IND-CCA2 security, and provides
the additional properties noted above. Also, the analysis confirms the
expected properties hold under the different key compromise cases
mentioned above. The analysis considers a sender that sends one message
using the encryption context, and additionally exports two independent
secrets using the secret export interface.<a href="#section-9.1.2-5" class="pilcrow">¶</a></p>
<p id="section-9.1.2-6">The table below summarizes the main results from <span>[<a href="#HPKEAnalysis" class="cite xref">HPKEAnalysis</a>]</span>. N/A
means that a property does not apply for the given mode, whereas <code>Y</code> means
the given mode satisfies the property.<a href="#section-9.1.2-6" class="pilcrow">¶</a></p>
<table class="center" id="table-6">
            <caption><a href="#table-6" class="selfRef">Table 6</a></caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Variant</th>
                <th class="text-center" rowspan="1" colspan="1">Message Sec.</th>
                <th class="text-center" rowspan="1" colspan="1">Export Sec.</th>
                <th class="text-center" rowspan="1" colspan="1">Sender Auth.</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Base</td>
                <td class="text-center" rowspan="1" colspan="1">Y</td>
                <td class="text-center" rowspan="1" colspan="1">Y</td>
                <td class="text-center" rowspan="1" colspan="1">N/A</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">PSK</td>
                <td class="text-center" rowspan="1" colspan="1">Y</td>
                <td class="text-center" rowspan="1" colspan="1">Y</td>
                <td class="text-center" rowspan="1" colspan="1">Y</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Auth</td>
                <td class="text-center" rowspan="1" colspan="1">Y</td>
                <td class="text-center" rowspan="1" colspan="1">Y</td>
                <td class="text-center" rowspan="1" colspan="1">Y</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">AuthPSK</td>
                <td class="text-center" rowspan="1" colspan="1">Y</td>
                <td class="text-center" rowspan="1" colspan="1">Y</td>
                <td class="text-center" rowspan="1" colspan="1">Y</td>
              </tr>
            </tbody>
          </table>
<p id="section-9.1.2-8">If non-DH-based KEMs are to be used with HPKE, further analysis will be
necessary to prove their security. The results from <span>[<a href="#CS01" class="cite xref">CS01</a>]</span> provide
some indication that any IND-CCA2-secure KEM will suffice here, but are
not conclusive given the differences in the schemes.<a href="#section-9.1.2-8" class="pilcrow">¶</a></p>
<p id="section-9.1.2-9">A detailed computational analysis of HPKE's Auth mode single-shot
encryption API has been done in <span>[<a href="#ABHKLR20" class="cite xref">ABHKLR20</a>]</span>.
The paper defines security notions for authenticated
KEMs and for authenticated public key encryption, using the outsider and
insider security terminology known from signcryption <span>[<a href="#SigncryptionDZ10" class="cite xref">SigncryptionDZ10</a>]</span>.
The analysis proves that DHKEM's <code>AuthEncap()</code>/<code>AuthDecap()</code> interface
fulfills these notions for all Diffie-Hellman groups specified in this document.
The analysis also provides exact security bounds, under the assumptions that the
gap Diffie-Hellman (GDH) problem is hard in the appropriate subgroup <span>[<a href="#GAP" class="cite xref">GAP</a>]</span>,
and that HKDF can be modeled as a random oracle.<a href="#section-9.1.2-9" class="pilcrow">¶</a></p>
<p id="section-9.1.2-10">Further, <span>[<a href="#ABHKLR20" class="cite xref">ABHKLR20</a>]</span> proves composition theorems, showing that HPKE's
Auth mode fulfills the security notions of authenticated public key encryption
for all KDFs and AEAD schemes specified in this document, given any
authenticated KEM satisfying the previously defined security notions
for authenticated KEMs. The theorems assume that the KEM is perfectly correct;
they could easily be adapted to work with KEMs that have a nonzero but negligible
probability for decryption failure. The assumptions on the KDF are that <code>Extract()</code>
and <code>Expand()</code> can be modeled as pseudorandom functions wherein the first
argument is the key, respectively. The assumption for the AEAD is
IND-CPA and IND-CTXT security.<a href="#section-9.1.2-10" class="pilcrow">¶</a></p>
<p id="section-9.1.2-11">In summary, the analysis in <span>[<a href="#ABHKLR20" class="cite xref">ABHKLR20</a>]</span> proves that the single-shot encryption API of HPKE's
Auth mode satisfies the desired message confidentiality and sender
authentication properties listed at the beginning of this section;
it does not consider multiple messages, nor the secret export API.<a href="#section-9.1.2-11" class="pilcrow">¶</a></p>
</section>
</div>
<div id="post-quantum-security">
<section id="section-9.1.3">
          <h4 id="name-post-quantum-security">
<a href="#section-9.1.3" class="section-number selfRef">9.1.3. </a><a href="#name-post-quantum-security" class="section-name selfRef">Post-Quantum Security</a>
          </h4>
<p id="section-9.1.3-1">All of <span>[<a href="#CS01" class="cite xref">CS01</a>]</span>, <span>[<a href="#HPKEAnalysis" class="cite xref">HPKEAnalysis</a>]</span>, and <span>[<a href="#ABHKLR20" class="cite xref">ABHKLR20</a>]</span> are premised on
classical security models and assumptions, and do not consider
adversaries capable of quantum computation. A full proof of post-quantum
security would need to take appropriate security models and assumptions
into account, in addition to simply using a post-quantum KEM. However,
the composition theorems from <span>[<a href="#ABHKLR20" class="cite xref">ABHKLR20</a>]</span> for HPKE's Auth mode only make
standard assumptions (i.e., no random oracle assumption) that are expected
to hold against quantum adversaries (although with slightly worse bounds).
Thus, these composition theorems, in combination with a post-quantum-secure
authenticated KEM, guarantee the post-quantum security of HPKE's Auth mode.<a href="#section-9.1.3-1" class="pilcrow">¶</a></p>
<p id="section-9.1.3-2">In future work, the analysis from <span>[<a href="#ABHKLR20" class="cite xref">ABHKLR20</a>]</span> can be extended to cover
HPKE's other modes and desired security properties.
The hybrid quantum-resistance property described above, which is achieved
by using the PSK or AuthPSK mode, is not proven in <span>[<a href="#HPKEAnalysis" class="cite xref">HPKEAnalysis</a>]</span> because
this analysis requires the random oracle model; in a quantum
setting, this model needs adaption to, for example, the quantum random
oracle model.<a href="#section-9.1.3-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="kem-security">
<section id="section-9.2">
        <h3 id="name-security-requirements-on-a-">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-security-requirements-on-a-" class="section-name selfRef">Security Requirements on a KEM Used within HPKE</a>
        </h3>
<p id="section-9.2-1">A KEM used within HPKE MUST allow HPKE to satisfy its desired security
properties described in <a href="#sec-properties" class="auto internal xref">Section 9.1</a>. <a href="#domain-separation" class="auto internal xref">Section 9.6</a> lists
requirements concerning domain separation.<a href="#section-9.2-1" class="pilcrow">¶</a></p>
<p id="section-9.2-2">In particular, the KEM
shared secret MUST be a uniformly random byte string of length <code>Nsecret</code>.
This means, for instance, that it would not be sufficient if the KEM
shared secret is only uniformly random as an element of some set prior
to its encoding as a byte string.<a href="#section-9.2-2" class="pilcrow">¶</a></p>
<div id="encapdecap-interface">
<section id="section-9.2.1">
          <h4 id="name-encap-decap-interface">
<a href="#section-9.2.1" class="section-number selfRef">9.2.1. </a><a href="#name-encap-decap-interface" class="section-name selfRef">Encap/Decap Interface</a>
          </h4>
<p id="section-9.2.1-1">As mentioned in <a href="#sec-considerations" class="auto internal xref">Section 9</a>, <span>[<a href="#CS01" class="cite xref">CS01</a>]</span> provides some indications
that if the KEM's <code>Encap()</code>/<code>Decap()</code> interface (which is used in the Base
and PSK modes) is IND-CCA2-secure, HPKE is able to satisfy its desired
security properties. An appropriate definition of IND-CCA2 security for
KEMs can be found in <span>[<a href="#CS01" class="cite xref">CS01</a>]</span> and <span>[<a href="#BHK09" class="cite xref">BHK09</a>]</span>.<a href="#section-9.2.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authencapauthdecap-interface">
<section id="section-9.2.2">
          <h4 id="name-authencap-authdecap-interfa">
<a href="#section-9.2.2" class="section-number selfRef">9.2.2. </a><a href="#name-authencap-authdecap-interfa" class="section-name selfRef">AuthEncap/AuthDecap Interface</a>
          </h4>
<p id="section-9.2.2-1">The analysis of HPKE's Auth mode single-shot encryption API in <span>[<a href="#ABHKLR20" class="cite xref">ABHKLR20</a>]</span>
provides composition theorems that guarantee that HPKE's Auth mode achieves
its desired security properties if the KEM's <code>AuthEncap()</code>/<code>AuthDecap()</code>
interface satisfies multi-user Outsider-CCA, Outsider-Auth, and
Insider-CCA security, as defined in the same paper.<a href="#section-9.2.2-1" class="pilcrow">¶</a></p>
<p id="section-9.2.2-2">Intuitively, Outsider-CCA security formalizes confidentiality, and
Outsider-Auth security formalizes authentication of the KEM shared secret
in case none of the sender or recipient private keys are compromised.
Insider-CCA security formalizes confidentiality of the KEM shared secret
in case the sender private key is known or chosen by the adversary.
(If the recipient private key is known or chosen by the adversary,
confidentiality is trivially broken, because then the adversary knows
all secrets on the recipient's side).<a href="#section-9.2.2-2" class="pilcrow">¶</a></p>
<p id="section-9.2.2-3">An Insider-Auth security notion would formalize authentication of the
KEM shared secret in case the recipient private key is known or chosen
by the adversary. (If the sender private key is known or chosen by the
adversary, it can create KEM ciphertexts in the name of the sender).
Because of the generic attack on an analogous Insider-Auth security
notion of HPKE described in <a href="#sec-properties" class="auto internal xref">Section 9.1</a>, a definition of
Insider-Auth security for KEMs used within HPKE is not useful.<a href="#section-9.2.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="kem-key-reuse">
<section id="section-9.2.3">
          <h4 id="name-kem-key-reuse">
<a href="#section-9.2.3" class="section-number selfRef">9.2.3. </a><a href="#name-kem-key-reuse" class="section-name selfRef">KEM Key Reuse</a>
          </h4>
<p id="section-9.2.3-1">An <code>ikm</code> input to <code>DeriveKeyPair()</code> (<a href="#derive-key-pair" class="auto internal xref">Section 7.1.3</a>) MUST NOT be
reused elsewhere, in particular not with <code>DeriveKeyPair()</code> of a
different KEM.<a href="#section-9.2.3-1" class="pilcrow">¶</a></p>
<p id="section-9.2.3-2">The randomness used in <code>Encap()</code> and <code>AuthEncap()</code> to generate the
KEM shared secret or its encapsulation MUST NOT be reused elsewhere.<a href="#section-9.2.3-2" class="pilcrow">¶</a></p>
<p id="section-9.2.3-3">Since a KEM key pair belonging to a sender or recipient works with all modes, it can
be used with multiple modes in parallel. HPKE is constructed to be
secure in such settings due to domain separation using the <code>suite_id</code>
variable. However, there is no formal proof of security at the time of
writing for using multiple modes in parallel; <span>[<a href="#HPKEAnalysis" class="cite xref">HPKEAnalysis</a>]</span> and
<span>[<a href="#ABHKLR20" class="cite xref">ABHKLR20</a>]</span> only analyze isolated modes.<a href="#section-9.2.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="kdf-choice">
<section id="section-9.3">
        <h3 id="name-security-requirements-on-a-k">
<a href="#section-9.3" class="section-number selfRef">9.3. </a><a href="#name-security-requirements-on-a-k" class="section-name selfRef">Security Requirements on a KDF</a>
        </h3>
<p id="section-9.3-1">The choice of the KDF for HPKE SHOULD be made based on the security
level provided by the KEM and, if applicable, by the PSK. The KDF
SHOULD at least have the security level of the KEM and SHOULD
at least have the security level provided by the PSK.<a href="#section-9.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="aead-security">
<section id="section-9.4">
        <h3 id="name-security-requirements-on-an">
<a href="#section-9.4" class="section-number selfRef">9.4. </a><a href="#name-security-requirements-on-an" class="section-name selfRef">Security Requirements on an AEAD</a>
        </h3>
<p id="section-9.4-1">All AEADs MUST be IND-CCA2-secure, as is currently true for all AEADs
listed in <a href="#aead-ids" class="auto internal xref">Section 7.3</a>.<a href="#section-9.4-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="security-psk">
<section id="section-9.5">
        <h3 id="name-pre-shared-key-recommendati">
<a href="#section-9.5" class="section-number selfRef">9.5. </a><a href="#name-pre-shared-key-recommendati" class="section-name selfRef">Pre-Shared Key Recommendations</a>
        </h3>
<p id="section-9.5-1">In the PSK and AuthPSK modes, the PSK MUST have at least 32 bytes of
entropy and SHOULD be of length <code>Nh</code> bytes or longer. Using a PSK longer than
32 bytes but shorter than <code>Nh</code> bytes is permitted.<a href="#section-9.5-1" class="pilcrow">¶</a></p>
<p id="section-9.5-2">HPKE is specified to use HKDF as its key derivation function. HKDF is not
designed to slow down dictionary attacks (see <span>[<a href="#RFC5869" class="cite xref">RFC5869</a>]</span>). Thus, HPKE's
PSK mechanism is not suitable for use with a low-entropy password as the
PSK: In scenarios in which the adversary knows the KEM shared secret
<code>shared_secret</code> and has access to an oracle that distinguishes between
a good and a wrong PSK, it can perform PSK-recovering attacks. This oracle
can be the decryption operation on a captured HPKE ciphertext or any other
recipient behavior that is observably different when using a wrong PSK.
The adversary knows the KEM shared secret <code>shared_secret</code> if it knows all
KEM private keys of one participant. In the PSK mode, this is trivially
the case if the adversary acts as the sender.<a href="#section-9.5-2" class="pilcrow">¶</a></p>
<p id="section-9.5-3">To recover a lower entropy PSK, an attacker in this scenario can trivially
perform a dictionary attack. Given a set <code>S</code> of possible PSK values, the
attacker generates an HPKE ciphertext for each value in <code>S</code>, and submits
the resulting ciphertexts to the oracle to learn which PSK is being used by
the recipient. Further, because HPKE uses AEAD schemes that are not key-committing,
an attacker can mount a partitioning oracle attack <span>[<a href="#LGR20" class="cite xref">LGR20</a>]</span> that can recover
the PSK from a set of <code>S</code> possible PSK values, with |S| = m*k, in roughly
m + log k queries to the oracle using ciphertexts of length proportional to
k, the maximum message length in blocks. (Applying the multi-collision algorithm from
<span>[<a href="#LGR20" class="cite xref">LGR20</a>]</span> requires a small adaptation to the algorithm wherein the appropriate nonce
is computed for each candidate key. This modification adds one call to HKDF per key.
The number of partitioning oracle queries remains unchanged.) As a result, the PSK
must therefore be chosen with sufficient entropy so that m + log k is prohibitive for
attackers (e.g., 2^128). Future specifications can define new AEAD algorithms that
are key-committing.<a href="#section-9.5-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="domain-separation">
<section id="section-9.6">
        <h3 id="name-domain-separation">
<a href="#section-9.6" class="section-number selfRef">9.6. </a><a href="#name-domain-separation" class="section-name selfRef">Domain Separation</a>
        </h3>
<p id="section-9.6-1">HPKE allows combining a DHKEM variant <code>DHKEM(Group, KDF')</code> and a KDF
such that both KDFs are instantiated by the same KDF. By design, the
calls to <code>Extract()</code> and <code>Expand()</code> inside DHKEM and the remainder of
HPKE use separate input domains. This justifies modeling them as
independent functions even if instantiated by the same KDF.
This domain separation between DHKEM and the remainder of HPKE is achieved by
using prefix-free sets of <code>suite_id</code> values in <code>LabeledExtract()</code> and
<code>LabeledExpand()</code> (<code>KEM...</code> in DHKEM and <code>HPKE...</code> in the remainder of HPKE).
Recall that a set is prefix-free if no element is a prefix of another within the
set.<a href="#section-9.6-1" class="pilcrow">¶</a></p>
<p id="section-9.6-2">Future KEM instantiations MUST ensure, should <code>Extract()</code> and
<code>Expand()</code> be used internally, that they can be modeled as functions
independent from the invocations of <code>Extract()</code> and <code>Expand()</code> in the
remainder of HPKE. One way to ensure this is by using <code>LabeledExtract()</code>
and <code>LabeledExpand()</code> with a <code>suite_id</code> as defined in <a href="#base-crypto" class="auto internal xref">Section 4</a>,
which will ensure input domain separation, as outlined above.
Particular attention needs to
be paid if the KEM directly invokes functions that are used internally
in HPKE's <code>Extract()</code> or <code>Expand()</code>, such as <code>Hash()</code> and <code>HMAC()</code> in the case of HKDF.
It MUST be ensured that inputs to these invocations cannot collide with
inputs to the internal invocations of these functions inside <code>Extract()</code> or
<code>Expand()</code>. In HPKE's <code>KeySchedule()</code> this is avoided by using <code>Extract()</code> instead of
<code>Hash()</code> on the arbitrary-length inputs <code>info</code> and <code>psk_id</code>.<a href="#section-9.6-2" class="pilcrow">¶</a></p>
<p id="section-9.6-3">The string literal "HPKE-v1" used in <code>LabeledExtract()</code> and <code>LabeledExpand()</code>
ensures that any secrets derived in HPKE are bound to the scheme's name
and version, even when possibly derived from the same Diffie-Hellman or
KEM shared secret as in another scheme or version.<a href="#section-9.6-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="non-goals">
<section id="section-9.7">
        <h3 id="name-application-embedding-and-n">
<a href="#section-9.7" class="section-number selfRef">9.7. </a><a href="#name-application-embedding-and-n" class="section-name selfRef">Application Embedding and Non-Goals</a>
        </h3>
<p id="section-9.7-1">HPKE is designed to be a fairly low-level mechanism.  As a result, it assumes
that certain properties are provided by the application in which HPKE is
embedded and leaves certain security properties to be provided by other
mechanisms. Otherwise said, certain properties are out-of-scope for HPKE.<a href="#section-9.7-1" class="pilcrow">¶</a></p>
<div id="message-order-and-message-loss">
<section id="section-9.7.1">
          <h4 id="name-message-order-and-message-l">
<a href="#section-9.7.1" class="section-number selfRef">9.7.1. </a><a href="#name-message-order-and-message-l" class="section-name selfRef">Message Order and Message Loss</a>
          </h4>
<p id="section-9.7.1-1">The primary requirement that HPKE imposes on applications is the requirement
that ciphertexts MUST be presented to <code>ContextR.Open()</code> in the same order in
which they were generated by <code>ContextS.Seal()</code>.  When the single-shot API is
used (see <a href="#single-shot-apis" class="auto internal xref">Section 6</a>), this is trivially true (since there is only
ever one ciphertext.  Applications that allow for multiple invocations of
<code>Open()</code> / <code>Seal()</code> on the same context MUST enforce the ordering property
described above.<a href="#section-9.7.1-1" class="pilcrow">¶</a></p>
<p id="section-9.7.1-2">Ordering requirements of this character are usually fulfilled by providing a
sequence number in the framing of encrypted messages.  Whatever information is
used to determine the ordering of HPKE-encrypted messages SHOULD be included in
the AAD passed to <code>ContextS.Seal()</code> and <code>ContextR.Open()</code>.  The specifics of
this scheme are up to the application.<a href="#section-9.7.1-2" class="pilcrow">¶</a></p>
<p id="section-9.7.1-3">HPKE is not tolerant of lost messages. Applications MUST be able to detect when
a message has been lost.  When an unrecoverable loss is detected, the application MUST discard
any associated HPKE context.<a href="#section-9.7.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="downgrade-prevention">
<section id="section-9.7.2">
          <h4 id="name-downgrade-prevention">
<a href="#section-9.7.2" class="section-number selfRef">9.7.2. </a><a href="#name-downgrade-prevention" class="section-name selfRef">Downgrade Prevention</a>
          </h4>
<p id="section-9.7.2-1">HPKE assumes that the sender and recipient agree on what algorithms to use.
Depending on how these algorithms are negotiated, it may be possible for an
intermediary to force the two parties to use suboptimal algorithms.<a href="#section-9.7.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="replay-protection">
<section id="section-9.7.3">
          <h4 id="name-replay-protection">
<a href="#section-9.7.3" class="section-number selfRef">9.7.3. </a><a href="#name-replay-protection" class="section-name selfRef">Replay Protection</a>
          </h4>
<p id="section-9.7.3-1">The requirement that ciphertexts be presented to the <code>ContextR.Open()</code> function
in the same order they were generated by <code>ContextS.Seal()</code> provides a degree of
replay protection within a stream of ciphertexts resulting from a given context.
HPKE provides no other replay protection.<a href="#section-9.7.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="forward-secrecy">
<section id="section-9.7.4">
          <h4 id="name-forward-secrecy">
<a href="#section-9.7.4" class="section-number selfRef">9.7.4. </a><a href="#name-forward-secrecy" class="section-name selfRef">Forward Secrecy</a>
          </h4>
<p id="section-9.7.4-1">HPKE ciphertexts are not forward secret with respect to recipient compromise
in any mode. This means that compromise of long-term recipient secrets allows
an attacker to decrypt past ciphertexts encrypted under said secrets. This is because
only long-term secrets are used on the side of the recipient.<a href="#section-9.7.4-1" class="pilcrow">¶</a></p>
<p id="section-9.7.4-2">HPKE ciphertexts are forward secret with respect to sender compromise in all
modes. This is because ephemeral randomness is used on the sender's side, which
is supposed to be erased directly after computation of the KEM shared secret and
ciphertext.<a href="#section-9.7.4-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="bad-ephemeral-randomness">
<section id="section-9.7.5">
          <h4 id="name-bad-ephemeral-randomness">
<a href="#section-9.7.5" class="section-number selfRef">9.7.5. </a><a href="#name-bad-ephemeral-randomness" class="section-name selfRef">Bad Ephemeral Randomness</a>
          </h4>
<p id="section-9.7.5-1">If the randomness used for KEM encapsulation is bad -- i.e., of low entropy or
compromised because of a broken or subverted random number generator -- the
confidentiality guarantees of HPKE degrade significantly. In Base mode,
confidentiality guarantees can be lost completely; in the other modes, at least forward secrecy with
respect to sender compromise can be lost completely.<a href="#section-9.7.5-1" class="pilcrow">¶</a></p>
<p id="section-9.7.5-2">Such a situation could also lead to the reuse of the same KEM shared secret
and thus to the reuse of same key-nonce pairs for the AEAD.
The AEADs specified in this document are not secure
in case of nonce reuse. This attack vector is particularly relevant in
authenticated modes because knowledge of the ephemeral randomness is not
enough to derive <code>shared_secret</code> in these modes.<a href="#section-9.7.5-2" class="pilcrow">¶</a></p>
<p id="section-9.7.5-3">One way for applications to mitigate the impacts of bad ephemeral randomness is
to combine ephemeral randomness with a local long-term secret that has been
generated securely, as described in <span>[<a href="#RFC8937" class="cite xref">RFC8937</a>]</span>.<a href="#section-9.7.5-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="hiding-plaintext-length">
<section id="section-9.7.6">
          <h4 id="name-hiding-plaintext-length">
<a href="#section-9.7.6" class="section-number selfRef">9.7.6. </a><a href="#name-hiding-plaintext-length" class="section-name selfRef">Hiding Plaintext Length</a>
          </h4>
<p id="section-9.7.6-1">AEAD ciphertexts produced by HPKE do not hide the plaintext length. Applications
requiring this level of privacy should use a suitable padding mechanism. See
<span>[<a href="#I-D.ietf-tls-esni" class="cite xref">I-D.ietf-tls-esni</a>]</span> and <span>[<a href="#RFC8467" class="cite xref">RFC8467</a>]</span> for examples of protocol-specific
padding policies.<a href="#section-9.7.6-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="bidirectional">
<section id="section-9.8">
        <h3 id="name-bidirectional-encryption">
<a href="#section-9.8" class="section-number selfRef">9.8. </a><a href="#name-bidirectional-encryption" class="section-name selfRef">Bidirectional Encryption</a>
        </h3>
<p id="section-9.8-1">As discussed in <a href="#hpke-dem" class="auto internal xref">Section 5.2</a>, HPKE encryption is unidirectional from sender
to recipient. Applications that require bidirectional encryption can derive
necessary keying material with the secret export interface <a href="#hpke-export" class="auto internal xref">Section 5.3</a>.
The type and length of such keying material depends on the application use
case.<a href="#section-9.8-1" class="pilcrow">¶</a></p>
<p id="section-9.8-2">As an example, if an application needs AEAD encryption from the recipient to
the sender, it can derive a key and nonce from the corresponding HPKE context
as follows:<a href="#section-9.8-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-9.8-3">
<pre>
key = context.Export("response key", Nk)
nonce = context.Export("response nonce", Nn)
</pre><a href="#section-9.8-3" class="pilcrow">¶</a>
</div>
<p id="section-9.8-4">In this example, the length of each secret is based on the AEAD algorithm
used for the corresponding HPKE context.<a href="#section-9.8-4" class="pilcrow">¶</a></p>
<p id="section-9.8-5">Note that HPKE's limitations with regard to sender authentication become limits
on recipient authentication in this context. In particular, in the Base mode,
there is no authentication of the remote party at all. Even in the Auth mode,
where the remote party has proven that they hold a specific private key, this
authentication is still subject to key-compromise impersonation, as discussed
in <a href="#kci" class="auto internal xref">Section 9.1.1</a>.<a href="#section-9.8-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="metadata-protection">
<section id="section-9.9">
        <h3 id="name-metadata-protection">
<a href="#section-9.9" class="section-number selfRef">9.9. </a><a href="#name-metadata-protection" class="section-name selfRef">Metadata Protection</a>
        </h3>
<p id="section-9.9-1">The authenticated modes of HPKE (PSK, Auth, and AuthPSK) require that the recipient
know what key material to use for the sender.  This can be signaled in
applications by sending the PSK ID (<code>psk_id</code> above) and/or the sender's public
key (<code>pkS</code>).  However, these values themselves might be considered sensitive,
since, in a given application context, they might identify the sender.<a href="#section-9.9-1" class="pilcrow">¶</a></p>
<p id="section-9.9-2">An application that wishes to protect these metadata values without requiring
further provisioning of keys can use an additional instance of HPKE, using the
unauthenticated Base mode.  Where the application might have sent <code>(psk_id, pkS,
enc, ciphertext)</code> before, it would now send <code>(enc2, ciphertext2, enc, ciphertext)</code>,
where <code>(enc2, ciphertext2)</code> represent the encryption of the <code>psk_id</code> and <code>pkS</code>
values.<a href="#section-9.9-2" class="pilcrow">¶</a></p>
<p id="section-9.9-3">The cost of this approach is an additional KEM operation each for the sender and
the recipient.  A potential lower-cost approach (involving only symmetric
operations) would be available if the nonce-protection schemes in <span>[<a href="#BNT19" class="cite xref">BNT19</a>]</span>
could be extended to cover other metadata.  However, this construction would
require further analysis.<a href="#section-9.9-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="message-encoding">
<section id="section-10">
      <h2 id="name-message-encoding">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-message-encoding" class="section-name selfRef">Message Encoding</a>
      </h2>
<p id="section-10-1">This document does not specify a wire format encoding for HPKE messages. Applications
that adopt HPKE must therefore specify an unambiguous encoding mechanism that includes,
minimally: the encapsulated value <code>enc</code>, ciphertext value(s) (and order if there are
multiple), and any info values that are not implicit. One example of a non-implicit
value is the recipient public key used for encapsulation, which may be needed if a
recipient has more than one public key.<a href="#section-10-1" class="pilcrow">¶</a></p>
<p id="section-10-2">The AEAD interface used in this document is based on <span>[<a href="#RFC5116" class="cite xref">RFC5116</a>]</span>, which produces and
consumes a single ciphertext value. As discussed in <span>[<a href="#RFC5116" class="cite xref">RFC5116</a>]</span>, this ciphertext value
contains the encrypted plaintext as well as any authentication data, encoded in a manner
described by the individual AEAD scheme. Some implementations are not structured in this
way, instead providing a separate ciphertext and authentication tag. When such
AEAD implementations are used in HPKE implementations, the HPKE implementation must combine
these inputs into a single ciphertext value within <code>Seal()</code> and parse them out within
<code>Open()</code>, where the parsing details are defined by the AEAD scheme. For example, with
the AES-GCM schemes specified in this document, the GCM authentication tag is placed in
the last Nt bytes of the ciphertext output.<a href="#section-10-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana">
<section id="section-11">
      <h2 id="name-iana-considerations">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-11-1">IANA has created three new registries:<a href="#section-11-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-11-2.1">
          <p id="section-11-2.1.1">HPKE KEM Identifiers<a href="#section-11-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-11-2.2">
          <p id="section-11-2.2.1">HPKE KDF Identifiers<a href="#section-11-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-11-2.3">
          <p id="section-11-2.3.1">HPKE AEAD Identifiers<a href="#section-11-2.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-11-3">All these registries are under "Hybrid Public Key
Encryption", and administered under a Specification Required policy <span>[<a href="#RFC8126" class="cite xref">RFC8126</a>]</span><a href="#section-11-3" class="pilcrow">¶</a></p>
<div id="kem-template">
<section id="section-11.1">
        <h3 id="name-kem-identifiers">
<a href="#section-11.1" class="section-number selfRef">11.1. </a><a href="#name-kem-identifiers" class="section-name selfRef">KEM Identifiers</a>
        </h3>
<p id="section-11.1-1">The "HPKE KEM Identifiers" registry lists identifiers for key encapsulation
algorithms defined for use with HPKE.  These identifiers are two-byte values,
so the maximum possible value is 0xFFFF = 65535.<a href="#section-11.1-1" class="pilcrow">¶</a></p>
<p id="section-11.1-2">Template:<a href="#section-11.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-11.1-3.1">
            <p id="section-11.1-3.1.1">Value: The two-byte identifier for the algorithm<a href="#section-11.1-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-11.1-3.2">
            <p id="section-11.1-3.2.1">KEM: The name of the algorithm<a href="#section-11.1-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-11.1-3.3">
            <p id="section-11.1-3.3.1">Nsecret: The length in bytes of a KEM shared secret produced by the algorithm<a href="#section-11.1-3.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-11.1-3.4">
            <p id="section-11.1-3.4.1">Nenc: The length in bytes of an encoded encapsulated key produced by the algorithm<a href="#section-11.1-3.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-11.1-3.5">
            <p id="section-11.1-3.5.1">Npk: The length in bytes of an encoded public key for the algorithm<a href="#section-11.1-3.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-11.1-3.6">
            <p id="section-11.1-3.6.1">Nsk: The length in bytes of an encoded private key for the algorithm<a href="#section-11.1-3.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-11.1-3.7">
            <p id="section-11.1-3.7.1">Auth: A boolean indicating if this algorithm provides the <code>AuthEncap()</code>/<code>AuthDecap()</code> interface<a href="#section-11.1-3.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-11.1-3.8">
            <p id="section-11.1-3.8.1">Reference: Where this algorithm is defined<a href="#section-11.1-3.8.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-11.1-4">Initial contents: Provided in <a href="#kemid-values" class="auto internal xref">Table 2</a><a href="#section-11.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="kdf-identifiers">
<section id="section-11.2">
        <h3 id="name-kdf-identifiers">
<a href="#section-11.2" class="section-number selfRef">11.2. </a><a href="#name-kdf-identifiers" class="section-name selfRef">KDF Identifiers</a>
        </h3>
<p id="section-11.2-1">The "HPKE KDF Identifiers" registry lists identifiers for key derivation
functions defined for use with HPKE.  These identifiers are two-byte values,
so the maximum possible value is 0xFFFF = 65535.<a href="#section-11.2-1" class="pilcrow">¶</a></p>
<p id="section-11.2-2">Template:<a href="#section-11.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-11.2-3.1">
            <p id="section-11.2-3.1.1">Value: The two-byte identifier for the algorithm<a href="#section-11.2-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-11.2-3.2">
            <p id="section-11.2-3.2.1">KDF: The name of the algorithm<a href="#section-11.2-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-11.2-3.3">
            <p id="section-11.2-3.3.1">Nh: The output size of the Extract function in bytes<a href="#section-11.2-3.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-11.2-3.4">
            <p id="section-11.2-3.4.1">Reference: Where this algorithm is defined<a href="#section-11.2-3.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-11.2-4">Initial contents: Provided in <a href="#kdfid-values" class="auto internal xref">Table 3</a><a href="#section-11.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="aead-identifiers">
<section id="section-11.3">
        <h3 id="name-aead-identifiers">
<a href="#section-11.3" class="section-number selfRef">11.3. </a><a href="#name-aead-identifiers" class="section-name selfRef">AEAD Identifiers</a>
        </h3>
<p id="section-11.3-1">The "HPKE AEAD Identifiers" registry lists identifiers for authenticated
encryption with associated data (AEAD) algorithms defined for use with HPKE.
These identifiers are two-byte values, so the maximum possible value is
0xFFFF = 65535.<a href="#section-11.3-1" class="pilcrow">¶</a></p>
<p id="section-11.3-2">Template:<a href="#section-11.3-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-11.3-3.1">
            <p id="section-11.3-3.1.1">Value: The two-byte identifier for the algorithm<a href="#section-11.3-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-11.3-3.2">
            <p id="section-11.3-3.2.1">AEAD: The name of the algorithm<a href="#section-11.3-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-11.3-3.3">
            <p id="section-11.3-3.3.1">Nk: The length in bytes of a key for this algorithm<a href="#section-11.3-3.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-11.3-3.4">
            <p id="section-11.3-3.4.1">Nn: The length in bytes of a nonce for this algorithm<a href="#section-11.3-3.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-11.3-3.5">
            <p id="section-11.3-3.5.1">Nt: The length in bytes of an authentication tag for this algorithm<a href="#section-11.3-3.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-11.3-3.6">
            <p id="section-11.3-3.6.1">Reference: Where this algorithm is defined<a href="#section-11.3-3.6.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-11.3-4">Initial contents: Provided in <a href="#aeadid-values" class="auto internal xref">Table 5</a><a href="#section-11.3-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-combined-references">
<section id="section-12">
      <h2 id="name-references">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-12.1">
        <h3 id="name-normative-references">
<a href="#section-12.1" class="section-number selfRef">12.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5116">[RFC5116]</dt>
        <dd>
<span class="refAuthor">McGrew, D.</span>, <span class="refTitle">"An Interface and Algorithms for Authenticated Encryption"</span>, <span class="seriesInfo">RFC 5116</span>, <span class="seriesInfo">DOI 10.17487/RFC5116</span>, <time datetime="2008-01" class="refDate">January 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc5116">https://www.rfc-editor.org/rfc/rfc5116</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8017">[RFC8017]</dt>
        <dd>
<span class="refAuthor">Moriarty, K., Ed.</span>, <span class="refAuthor">Kaliski, B.</span>, <span class="refAuthor">Jonsson, J.</span>, and <span class="refAuthor">A. Rusch</span>, <span class="refTitle">"PKCS #1: RSA Cryptography Specifications Version 2.2"</span>, <span class="seriesInfo">RFC 8017</span>, <span class="seriesInfo">DOI 10.17487/RFC8017</span>, <time datetime="2016-11" class="refDate">November 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8017">https://www.rfc-editor.org/rfc/rfc8017</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8126">[RFC8126]</dt>
        <dd>
<span class="refAuthor">Cotton, M.</span>, <span class="refAuthor">Leiba, B.</span>, and <span class="refAuthor">T. Narten</span>, <span class="refTitle">"Guidelines for Writing an IANA Considerations Section in RFCs"</span>, <span class="seriesInfo">BCP 26</span>, <span class="seriesInfo">RFC 8126</span>, <span class="seriesInfo">DOI 10.17487/RFC8126</span>, <time datetime="2017-06" class="refDate">June 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8126">https://www.rfc-editor.org/rfc/rfc8126</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
      <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-12.2">
        <h3 id="name-informative-references">
<a href="#section-12.2" class="section-number selfRef">12.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="ABHKLR20">[ABHKLR20]</dt>
        <dd>
<span class="refAuthor">Alwen, J.</span>, <span class="refAuthor">Blanchet, B.</span>, <span class="refAuthor">Hauck, E.</span>, <span class="refAuthor">Kiltz, E.</span>, <span class="refAuthor">Lipp, B.</span>, and <span class="refAuthor">D. Riepel</span>, <span class="refTitle">"Analysing the HPKE Standard"</span>, <time datetime="2020" class="refDate">2020</time>, <span>&lt;<a href="https://eprint.iacr.org/2020/1499">https://eprint.iacr.org/2020/1499</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="ANSI">[ANSI]</dt>
        <dd>
<span class="refAuthor">American National Standards Institute</span>, <span class="refTitle">"ANSI X9.63 Public Key Cryptography for the Financial Services Industry -- Key Agreement and Key Transport Using Elliptic Curve Cryptography"</span>, <time datetime="2001" class="refDate">2001</time>. </dd>
<dd class="break"></dd>
<dt id="BHK09">[BHK09]</dt>
        <dd>
<span class="refAuthor">Mihir Bellare</span>, <span class="refAuthor">Dennis Hofheinz</span>, and <span class="refAuthor">Eike Kiltz</span>, <span class="refTitle">"Subtleties in the Definition of IND-CCA: When and How Should Challenge-Decryption be Disallowed?"</span>, <time datetime="2009" class="refDate">2009</time>, <span>&lt;<a href="https://eprint.iacr.org/2009/418">https://eprint.iacr.org/2009/418</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="BJM97">[BJM97]</dt>
        <dd>
<span class="refAuthor">Blake-Wilson, S.</span>, <span class="refAuthor">Johnson, D.</span>, and <span class="refAuthor">A. Menezes</span>, <span class="refTitle">"Key agreement protocols and their security analysis: Extended Abstract"</span>, <span class="refContent">Springer Berlin Heidelberg</span>, <span class="seriesInfo">Lecture Notes in Computer Science pp. 30-45</span>, <span class="seriesInfo">DOI 10.1007/bfb0024447</span>, <span class="seriesInfo">ISBN ["9783540639275", "9783540696681"]</span>, <time datetime="1997" class="refDate">1997</time>, <span>&lt;<a href="https://doi.org/10.1007/bfb0024447">https://doi.org/10.1007/bfb0024447</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="BNT19">[BNT19]</dt>
        <dd>
<span class="refAuthor">Bellare, M.</span>, <span class="refAuthor">Ng, R.</span>, and <span class="refAuthor">B. Tackmann</span>, <span class="refTitle">"Nonces Are Noticed: AEAD Revisited"</span>, <time datetime="2019" class="refDate">2019</time>, <span>&lt;<a href="http://dx.doi.org/10.1007/978-3-030-26948-7_9">http://dx.doi.org/10.1007/978-3-030-26948-7_9</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="CS01">[CS01]</dt>
        <dd>
<span class="refAuthor">Cramer, R.</span> and <span class="refAuthor">V. Shoup</span>, <span class="refTitle">"Design and Analysis of Practical Public-Key Encryption Schemes Secure against Adaptive Chosen Ciphertext Attack"</span>, <time datetime="2001" class="refDate">2001</time>, <span>&lt;<a href="https://eprint.iacr.org/2001/108">https://eprint.iacr.org/2001/108</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="GAP">[GAP]</dt>
        <dd>
<span class="refAuthor">Okamoto, T.</span> and <span class="refAuthor">D. Pointcheval</span>, <span class="refTitle">"The Gap-Problems - a New Class of Problems for the Security of Cryptographic Schemes"</span>, <span class="seriesInfo">ISBN 978-3-540-44586-9</span>, <time datetime="2001" class="refDate">2001</time>, <span>&lt;<a href="https://link.springer.com/content/pdf/10.1007/3-540-44586-2_8.pdf">https://link.springer.com/content/pdf/10.1007/3-540-44586-2_8.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="GCM">[GCM]</dt>
        <dd>
<span class="refAuthor">Dworkin, M.</span>, <span class="refTitle">"Recommendation for block cipher modes of operation :: GaloisCounter Mode (GCM) and GMAC"</span>, <span class="refContent">National Institute of Standards and Technology</span>, <span class="seriesInfo">DOI 10.6028/nist.sp.800-38d</span>, <time datetime="2007" class="refDate">2007</time>, <span>&lt;<a href="https://doi.org/10.6028/nist.sp.800-38d">https://doi.org/10.6028/nist.sp.800-38d</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="HHK06">[HHK06]</dt>
        <dd>
<span class="refAuthor">Herranz, J.</span>, <span class="refAuthor">Hofheinz, D.</span>, and <span class="refAuthor">E. Kiltz</span>, <span class="refTitle">"Some (in)sufficient conditions for secure hybrid encryption"</span>, <time datetime="2006" class="refDate">2006</time>, <span>&lt;<a href="https://eprint.iacr.org/2006/265">https://eprint.iacr.org/2006/265</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="HPKEAnalysis">[HPKEAnalysis]</dt>
        <dd>
<span class="refAuthor">Lipp, B.</span>, <span class="refTitle">"An Analysis of Hybrid Public Key Encryption"</span>, <time datetime="2020" class="refDate">2020</time>, <span>&lt;<a href="https://eprint.iacr.org/2020/243">https://eprint.iacr.org/2020/243</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-mls-protocol">[I-D.ietf-mls-protocol]</dt>
        <dd>
<span class="refAuthor">Barnes, R.</span>, <span class="refAuthor">Beurdouche, B.</span>, <span class="refAuthor">Robert, R.</span>, <span class="refAuthor">Millican, J.</span>, <span class="refAuthor">Omara, E.</span>, and <span class="refAuthor">K. Cohn-Gordon</span>, <span class="refTitle">"The Messaging Layer Security (MLS) Protocol"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-mls-protocol-20</span>, <time datetime="2023-03-27" class="refDate">27 March 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-mls-protocol-20">https://datatracker.ietf.org/doc/html/draft-ietf-mls-protocol-20</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-tls-esni">[I-D.ietf-tls-esni]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refAuthor">Oku, K.</span>, <span class="refAuthor">Sullivan, N.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"TLS Encrypted Client Hello"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-tls-esni-24</span>, <time datetime="2025-03-20" class="refDate">20 March 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-tls-esni-24">https://datatracker.ietf.org/doc/html/draft-ietf-tls-esni-24</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="IEEE1363">[IEEE1363]</dt>
        <dd>
<span class="refAuthor">Institute of Electrical and Electronics Engineers</span>, <span class="refTitle">"IEEE 1363a, Standard Specifications for Public Key Cryptography - Amendment 1 -- Additional Techniques""</span>, <time datetime="2004" class="refDate">2004</time>. </dd>
<dd class="break"></dd>
<dt id="IMB">[IMB]</dt>
        <dd>
<span class="refAuthor">Diffie, W.</span>, <span class="refAuthor">Van Oorschot, P.</span>, and <span class="refAuthor">M. Wiener</span>, <span class="refTitle">"Authentication and authenticated key exchanges"</span>, <span class="refContent">Springer Science and Business Media LLC</span>, <span class="seriesInfo">Designs, Codes and Cryptography vol. 2, no. 2, pp. 107-125</span>, <span class="seriesInfo">DOI 10.1007/bf00124891</span>, <time datetime="1992-06" class="refDate">June 1992</time>, <span>&lt;<a href="https://doi.org/10.1007/bf00124891">https://doi.org/10.1007/bf00124891</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="ISO">[ISO]</dt>
        <dd>
<span class="refAuthor">International Organization for Standardization / International Electrotechnical Commission</span>, <span class="refTitle">"ISO/IEC 18033-2, Information Technology - Security Techniques - Encryption Algorithms - Part 2 -- Asymmetric Ciphers"</span>, <time datetime="2006" class="refDate">2006</time>. </dd>
<dd class="break"></dd>
<dt id="keyagreement">[keyagreement]</dt>
        <dd>
<span class="refAuthor">Barker, E.</span>, <span class="refAuthor">Chen, L.</span>, <span class="refAuthor">Roginsky, A.</span>, <span class="refAuthor">Vassilev, A.</span>, and <span class="refAuthor">R. Davis</span>, <span class="refTitle">"Recommendation for pair-wise key-establishment schemes using discrete logarithm cryptography"</span>, <span class="refContent">National Institute of Standards and Technology</span>, <span class="seriesInfo">DOI 10.6028/nist.sp.800-56ar3</span>, <time datetime="2018-04" class="refDate">April 2018</time>, <span>&lt;<a href="https://doi.org/10.6028/nist.sp.800-56ar3">https://doi.org/10.6028/nist.sp.800-56ar3</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="LGR20">[LGR20]</dt>
        <dd>
<span class="refAuthor">Len, J.</span>, <span class="refAuthor">Grubbs, P.</span>, and <span class="refAuthor">T. Ristenpart</span>, <span class="refTitle">"Partitioning Oracle Attacks"</span>, <time datetime="2021" class="refDate">2021</time>, <span>&lt;<a href="https://eprint.iacr.org/2020/1491">https://eprint.iacr.org/2020/1491</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="MAEA10">[MAEA10]</dt>
        <dd>
<span class="refAuthor">Gayoso Martinez, V.</span>, <span class="refAuthor">Hernandez Alvarez, F.</span>, <span class="refAuthor">Hernandez Encinas, L.</span>, and <span class="refAuthor">C. Sanchez Avila</span>, <span class="refTitle">"A Comparison of the Standardized Versions of ECIES"</span>, <time datetime="2010" class="refDate">2010</time>, <span>&lt;<a href="https://ieeexplore.ieee.org/abstract/document/5604194/">https://ieeexplore.ieee.org/abstract/document/5604194/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="NaCl">[NaCl]</dt>
        <dd>
<span class="refTitle">"Public-key authenticated encryption: crypto_box"</span>, <time datetime="2019" class="refDate">2019</time>, <span>&lt;<a href="https://nacl.cr.yp.to/box.html">https://nacl.cr.yp.to/box.html</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="NISTCurves">[NISTCurves]</dt>
        <dd>
<span class="refTitle">"Digital signature standard (DSS)"</span>, <span class="refContent">National Institute of Standards and Technology (U.S.)</span>, <span class="seriesInfo">DOI 10.6028/nist.fips.186-4</span>, <time datetime="2013" class="refDate">2013</time>, <span>&lt;<a href="https://doi.org/10.6028/nist.fips.186-4">https://doi.org/10.6028/nist.fips.186-4</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC1421">[RFC1421]</dt>
        <dd>
<span class="refAuthor">Linn, J.</span>, <span class="refTitle">"Privacy Enhancement for Internet Electronic Mail: Part I: Message Encryption and Authentication Procedures"</span>, <span class="seriesInfo">RFC 1421</span>, <span class="seriesInfo">DOI 10.17487/RFC1421</span>, <time datetime="1993-02" class="refDate">February 1993</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc1421">https://www.rfc-editor.org/rfc/rfc1421</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5869">[RFC5869]</dt>
        <dd>
<span class="refAuthor">Krawczyk, H.</span> and <span class="refAuthor">P. Eronen</span>, <span class="refTitle">"HMAC-based Extract-and-Expand Key Derivation Function (HKDF)"</span>, <span class="seriesInfo">RFC 5869</span>, <span class="seriesInfo">DOI 10.17487/RFC5869</span>, <time datetime="2010-05" class="refDate">May 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc5869">https://www.rfc-editor.org/rfc/rfc5869</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7748">[RFC7748]</dt>
        <dd>
<span class="refAuthor">Langley, A.</span>, <span class="refAuthor">Hamburg, M.</span>, and <span class="refAuthor">S. Turner</span>, <span class="refTitle">"Elliptic Curves for Security"</span>, <span class="seriesInfo">RFC 7748</span>, <span class="seriesInfo">DOI 10.17487/RFC7748</span>, <time datetime="2016-01" class="refDate">January 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7748">https://www.rfc-editor.org/rfc/rfc7748</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8439">[RFC8439]</dt>
        <dd>
<span class="refAuthor">Nir, Y.</span> and <span class="refAuthor">A. Langley</span>, <span class="refTitle">"ChaCha20 and Poly1305 for IETF Protocols"</span>, <span class="seriesInfo">RFC 8439</span>, <span class="seriesInfo">DOI 10.17487/RFC8439</span>, <time datetime="2018-06" class="refDate">June 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8439">https://www.rfc-editor.org/rfc/rfc8439</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8446">[RFC8446]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time datetime="2018-08" class="refDate">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8446">https://www.rfc-editor.org/rfc/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8467">[RFC8467]</dt>
        <dd>
<span class="refAuthor">Mayrhofer, A.</span>, <span class="refTitle">"Padding Policies for Extension Mechanisms for DNS (EDNS(0))"</span>, <span class="seriesInfo">RFC 8467</span>, <span class="seriesInfo">DOI 10.17487/RFC8467</span>, <time datetime="2018-10" class="refDate">October 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8467">https://www.rfc-editor.org/rfc/rfc8467</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8696">[RFC8696]</dt>
        <dd>
<span class="refAuthor">Housley, R.</span>, <span class="refTitle">"Using Pre-Shared Key (PSK) in the Cryptographic Message Syntax (CMS)"</span>, <span class="seriesInfo">RFC 8696</span>, <span class="seriesInfo">DOI 10.17487/RFC8696</span>, <time datetime="2019-12" class="refDate">December 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8696">https://www.rfc-editor.org/rfc/rfc8696</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8937">[RFC8937]</dt>
        <dd>
<span class="refAuthor">Cremers, C.</span>, <span class="refAuthor">Garratt, L.</span>, <span class="refAuthor">Smyshlyaev, S.</span>, <span class="refAuthor">Sullivan, N.</span>, and <span class="refAuthor">C. Wood</span>, <span class="refTitle">"Randomness Improvements for Security Protocols"</span>, <span class="seriesInfo">RFC 8937</span>, <span class="seriesInfo">DOI 10.17487/RFC8937</span>, <time datetime="2020-10" class="refDate">October 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8937">https://www.rfc-editor.org/rfc/rfc8937</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SECG">[SECG]</dt>
        <dd>
<span class="refTitle">"Elliptic Curve Cryptography, Standards for Efficient Cryptography Group, ver. 2"</span>, <time datetime="2009" class="refDate">2009</time>, <span>&lt;<a href="https://secg.org/sec1-v2.pdf">https://secg.org/sec1-v2.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SigncryptionDZ10">[SigncryptionDZ10]</dt>
        <dd>
<span class="refTitle">"Practical Signcryption"</span>, <span class="refContent">Springer Berlin Heidelberg</span>, <span class="seriesInfo">Information Security and Cryptography</span>, <span class="seriesInfo">DOI 10.1007/978-3-540-89411-7</span>, <span class="seriesInfo">ISBN ["9783540894094", "9783540894117"]</span>, <time datetime="2010" class="refDate">2010</time>, <span>&lt;<a href="https://doi.org/10.1007/978-3-540-89411-7">https://doi.org/10.1007/978-3-540-89411-7</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="TestVectors">[TestVectors]</dt>
      <dd>
<span class="refTitle">"HPKE Test Vectors"</span>, <time datetime="2021" class="refDate">2021</time>, <span>&lt;<a href="https://github.com/cfrg/draft-irtf-cfrg-hpke/blob/5f503c564da00b0687b3de75f1dfbdfc4079ad31/test-vectors.json">https://github.com/cfrg/draft-irtf-cfrg-hpke/blob/5f503c564da00b0687b3de75f1dfbdfc4079ad31/test-vectors.json</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="acknowledgements">
<section id="appendix-A">
      <h2 id="name-acknowledgements">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-acknowledgements" class="section-name selfRef">Acknowledgements</a>
      </h2>
<p id="appendix-A-1">The authors would like to thank Joël Alwen, Jean-Philippe Aumasson, David
Benjamin, Benjamin Beurdouche, Bruno Blanchet, Frank Denis, Stephen Farrell,
Scott Fluhrer, Eduard Hauck, Scott Hollenbeck, Kevin Jacobs, Burt Kaliski, Eike
Kiltz, Julia Len, John Mattsson, Christopher Patton, Doreen Riepel, Raphael
Robert, Michael Rosenberg, Michael Scott, Martin Thomson, Steven Valdez, Riad
Wahby, and other contributors in the CFRG for helpful feedback that greatly
improved this document.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="test-vectors">
<section id="appendix-B">
      <h2 id="name-test-vectors">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-test-vectors" class="section-name selfRef">Test Vectors</a>
      </h2>
<p id="appendix-B-1">Each section below contains test vectors for a single HPKE ciphersuite and
contains the following values:<a href="#appendix-B-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="appendix-B-2">
<li id="appendix-B-2.1">
          <p id="appendix-B-2.1.1">Configuration information and private key material: This includes the <code>mode</code>, <code>info</code> string, HPKE
ciphersuite identifiers (<code>kem_id</code>, <code>kdf_id</code>, <code>aead_id</code>), and all
sender, recipient, and ephemeral key material. For each role X,
where X is one of S, R, or E, as sender, recipient, and ephemeral,
respectively, key pairs are generated as <code>(skX, pkX) = DeriveKeyPair(ikmX)</code>.
Each key pair <code>(skX, pkX)</code> is written in its serialized form, where
<code>skXm = SerializePrivateKey(skX)</code> and <code>pkXm = SerializePublicKey(pkX)</code>.
For applicable modes, the shared PSK and PSK identifier are also included.<a href="#appendix-B-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="appendix-B-2.2">
          <p id="appendix-B-2.2.1">Context creation intermediate values and outputs: This includes the
KEM outputs <code>enc</code> and <code>shared_secret</code> used to create the context, along
with intermediate values <code>key_schedule_context</code> and <code>secret</code> computed
in the KeySchedule function in <a href="#encryption-context" class="auto internal xref">Section 5.1</a>. The outputs
include the context values <code>key</code>, <code>base_nonce</code>, and <code>exporter_secret</code>.<a href="#appendix-B-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li id="appendix-B-2.3">
          <p id="appendix-B-2.3.1">Encryption test vectors: A fixed plaintext message is encrypted using
different sequence numbers and AAD values using the context computed in (2).
Each test vector lists the sequence number and corresponding nonce computed
with <code>base_nonce</code>, the plaintext message <code>pt</code>, AAD <code>aad</code>, and output
ciphertext <code>ct</code>.<a href="#appendix-B-2.3.1" class="pilcrow">¶</a></p>
</li>
        <li id="appendix-B-2.4">
          <p id="appendix-B-2.4.1">Export test vectors: Several exported values of the same length with differing
context parameters are computed using the context computed in (2). Each test
vector lists the <code>exporter_context</code>, output length <code>L</code>, and resulting export
value.<a href="#appendix-B-2.4.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<p id="appendix-B-3">These test vectors are also available in JSON format at <span>[<a href="#TestVectors" class="cite xref">TestVectors</a>]</span>.<a href="#appendix-B-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-C">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Richard L. Barnes</span></div>
<div dir="auto" class="left"><span class="org">Cisco</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:rlb@ipv.sx" class="email">rlb@ipv.sx</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Karthik Bhargavan</span></div>
<div dir="auto" class="left"><span class="org">Inria</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:karthikeyan.bhargavan@inria.fr" class="email">karthikeyan.bhargavan@inria.fr</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Benjamin Lipp</span></div>
<div dir="auto" class="left"><span class="org">Inria</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:ietf@benjaminlipp.de" class="email">ietf@benjaminlipp.de</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Christopher A. Wood</span></div>
<div dir="auto" class="left"><span class="org">Apple</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:caw@heapingbits.net" class="email">caw@heapingbits.net</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
